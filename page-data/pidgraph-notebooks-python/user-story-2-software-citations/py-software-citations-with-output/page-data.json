{"componentChunkName":"component---src-templates-notebook-js","path":"/pidgraph-notebooks-python/user-story-2-software-citations/py-software-citations-with-output/","result":{"data":{"jupyterNotebook":{"html":"<div class=\"notebook-render\"><div class=\"sc-iwsKbI Dticx\"><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><table>\n<thead>\n<tr>\n<th><a>FREYA</a> WP2 <a>User Story 2</a></th>\n<th>As a software author, I want to be able to see the citations of my software aggregated across all versions, so that I see a complete picture of reuse.</th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n</tbody>\n</table>\n<p>Software development process involves versioned releases. Consequently, different software versions may be used for scientific discovery and thus referenced in publications. In order to quantify impact of a software, its author must be able to capture the reuse of the software across all its versions.\nThis notebook uses the <a>DataCite GraphQL API</a> to retrieve metadata about software titled: <a>Calculation Package: Inverting topography for landscape evolution model process representation</a>, including all its versions, so that its overall reuse can be quantified.</p>\n<p><strong>Goal</strong>: By the end of this notebook, for a given software you should be able to display:</p>\n<ul>\n<li>Counts of citations, views and downloads metrics, aggregated across all versions of the software</li>\n<li>An interactive stacked bar plot showing how the metric counts of each version contribute to the corresponding aggregated metric counts, e.g. </li>\n</ul></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Install libraries and prepare GraphQL client</h2></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[1]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#393A34\">%</span><span class=\"token\" style=\"color:#393A34\">%</span>capture\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Install required Python packages</span>\n!pip install gql requests numpy plotly</code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[2]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Prepare the GraphQL client</span>\n<span class=\"token\" style=\"color:#0000ff\">import</span> requests\n<span class=\"token\" style=\"color:#0000ff\">from</span> IPython<span class=\"token\" style=\"color:#393A34\">.</span>display <span class=\"token\" style=\"color:#0000ff\">import</span> display<span class=\"token\" style=\"color:#393A34\">,</span> Markdown\n<span class=\"token\" style=\"color:#0000ff\">from</span> gql <span class=\"token\" style=\"color:#0000ff\">import</span> gql<span class=\"token\" style=\"color:#393A34\">,</span> Client\n<span class=\"token\" style=\"color:#0000ff\">from</span> gql<span class=\"token\" style=\"color:#393A34\">.</span>transport<span class=\"token\" style=\"color:#393A34\">.</span>requests <span class=\"token\" style=\"color:#0000ff\">import</span> RequestsHTTPTransport\n\n_transport <span class=\"token\" style=\"color:#393A34\">=</span> RequestsHTTPTransport<span class=\"token\" style=\"color:#393A34\">(</span>\n    url<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;https://api.datacite.org/graphql&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    use_json<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\n\nclient <span class=\"token\" style=\"color:#393A34\">=</span> Client<span class=\"token\" style=\"color:#393A34\">(</span>\n    transport<span class=\"token\" style=\"color:#393A34\">=</span>_transport<span class=\"token\" style=\"color:#393A34\">,</span>\n    fetch_schema_from_transport<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Define and run GraphQL query</h2>\n<p>Define the GraphQL query to retrieve metadata for the software titled: <a>Calculation Package: Inverting topography for landscape evolution model process representation</a> using its DOI.</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[3]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Generate the GraphQL query to retrieve the required software&#x27;s metadata</span>\nquery_params <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;softwareId&quot;</span> <span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;https://doi.org/10.5281/zenodo.2799488&quot;</span>\n<span class=\"token\" style=\"color:#393A34\">}</span>\n\nquery <span class=\"token\" style=\"color:#393A34\">=</span> gql<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token,triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;query getSoftware($softwareId: ID!)\n{\n  software(id: $softwareId) {\n    id\n    titles {\n      title\n    }\n    publicationYear\n    citations {\n      nodes {\n        id\n        titles {\n          title\n        }        \n      }\n    }\n    version\n    versionCount\n    versionOfCount\n    citationCount\n    downloadCount\n    viewCount\n    versions {\n      nodes {\n        id\n        version\n        publicationYear\n        titles {\n          title\n        }\n        citations {\n          nodes {\n            id\n            titles {\n              title\n            }\n          }\n        }\n        version\n        versionCount\n        versionOfCount\n        citationCount\n        downloadCount\n        viewCount\n      }\n    }\n  }\n}\n&quot;&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><p>Run the above query via the GraphQL client</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[4]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> json\ndata <span class=\"token\" style=\"color:#393A34\">=</span> client<span class=\"token\" style=\"color:#393A34\">.</span>execute<span class=\"token\" style=\"color:#393A34\">(</span>query<span class=\"token\" style=\"color:#393A34\">,</span> variable_values<span class=\"token\" style=\"color:#393A34\">=</span>json<span class=\"token\" style=\"color:#393A34\">.</span>dumps<span class=\"token\" style=\"color:#393A34\">(</span>query_params<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Display total software metrics</h2>\n<p>Display total number of citations, views and downloads across all versions of software: <a>Calculation Package: Inverting topography for landscape evolution model process representation</a>.</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[5]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Get the total count per metric, aggregated for across all versions of the software</span>\nsoftware <span class=\"token\" style=\"color:#393A34\">=</span> data<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;software&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Initialise metric counts</span>\nmetricCounts <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> metric <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;citationCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;viewCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;downloadCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    metricCounts<span class=\"token\" style=\"color:#393A34\">[</span>metric<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n    \n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Aggregate metric counts across all the version</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> node <span class=\"token\" style=\"color:#0000ff\">in</span> software<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;versions&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;nodes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> metric <span class=\"token\" style=\"color:#0000ff\">in</span> metricCounts<span class=\"token\" style=\"color:#393A34\">:</span>\n         metricCounts<span class=\"token\" style=\"color:#393A34\">[</span>metric<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+=</span> node<span class=\"token\" style=\"color:#393A34\">[</span>metric<span class=\"token\" style=\"color:#393A34\">]</span>\n            \n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Display the aggregated metric counts</span>\ntableBody<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> metric <span class=\"token\" style=\"color:#0000ff\">in</span> metricCounts<span class=\"token\" style=\"color:#393A34\">:</span>        \n    tableBody <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#A31515\">&quot;%s | **%s**\\n&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> <span class=\"token\" style=\"color:#393A34\">(</span>metric<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token,builtin\">str</span><span class=\"token\" style=\"color:#393A34\">(</span>metricCounts<span class=\"token\" style=\"color:#393A34\">[</span>metric<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">if</span> tableBody<span class=\"token\" style=\"color:#393A34\">:</span>\n   display<span class=\"token\" style=\"color:#393A34\">(</span>Markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;Aggregated metric counts for software: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488) across all its versions:&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n   display<span class=\"token\" style=\"color:#393A34\">(</span>Markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;|Metric | Aggregated Count|\\n|---|---|\\n%s&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> tableBody<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-gzVnrw jFzGrB\"></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Plot metric counts per software version</h2>\n<p>Plot stacked bar plot showing how the individual versions of software: <a>Calculation Package: Inverting topography for landscape evolution model process representation</a> contribute their metric counts to the corresponding aggregated total.</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[6]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> plotly<span class=\"token\" style=\"color:#393A34\">.</span>io <span class=\"token\" style=\"color:#0000ff\">as</span> pio\n<span class=\"token\" style=\"color:#0000ff\">import</span> plotly<span class=\"token\" style=\"color:#393A34\">.</span>express <span class=\"token\" style=\"color:#0000ff\">as</span> px\n<span class=\"token\" style=\"color:#0000ff\">from</span> IPython<span class=\"token\" style=\"color:#393A34\">.</span>display <span class=\"token\" style=\"color:#0000ff\">import</span> IFrame\n<span class=\"token\" style=\"color:#0000ff\">import</span> pandas <span class=\"token\" style=\"color:#0000ff\">as</span> pd\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Adapted from: https://stackoverflow.com/questions/58766305/is-there-any-way-to-implement-stacked-or-grouped-bar-charts-in-plotly-express</span>\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">px_stacked_bar</span><span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">,</span> color_name<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;Metric&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> y_name<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;Metrics&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">**</span>pxargs<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    idx_col <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">.</span>index<span class=\"token\" style=\"color:#393A34\">.</span>name\n    m <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>melt<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> id_vars<span class=\"token\" style=\"color:#393A34\">=</span>idx_col<span class=\"token\" style=\"color:#393A34\">,</span> var_name<span class=\"token\" style=\"color:#393A34\">=</span>color_name<span class=\"token\" style=\"color:#393A34\">,</span> value_name<span class=\"token\" style=\"color:#393A34\">=</span>y_name<span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># For Plotly colour sequences see: https://plotly.com/python/discrete-color/     </span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> px<span class=\"token\" style=\"color:#393A34\">.</span>bar<span class=\"token\" style=\"color:#393A34\">(</span>m<span class=\"token\" style=\"color:#393A34\">,</span> x<span class=\"token\" style=\"color:#393A34\">=</span>idx_col<span class=\"token\" style=\"color:#393A34\">,</span> y<span class=\"token\" style=\"color:#393A34\">=</span>y_name<span class=\"token\" style=\"color:#393A34\">,</span> color<span class=\"token\" style=\"color:#393A34\">=</span>color_name<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">**</span>pxargs<span class=\"token\" style=\"color:#393A34\">,</span> \n                  color_discrete_sequence<span class=\"token\" style=\"color:#393A34\">=</span>px<span class=\"token\" style=\"color:#393A34\">.</span>colors<span class=\"token\" style=\"color:#393A34\">.</span>qualitative<span class=\"token\" style=\"color:#393A34\">.</span>Pastel1<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Collect metric counts</span>\nsoftware <span class=\"token\" style=\"color:#393A34\">=</span> data<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;software&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\nversion <span class=\"token\" style=\"color:#393A34\">=</span> software<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;version&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Initialise dicts for the stacked bar plot</span>\nlabels <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&#x27;All Software Versions&#x27;</span><span class=\"token\" style=\"color:#393A34\">}</span>\ncitationCounts <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\nviewCounts <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\ndownloadCounts <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Collect software/version labels</span>\nversionCnt <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> node <span class=\"token\" style=\"color:#0000ff\">in</span> software<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;versions&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;nodes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    version <span class=\"token\" style=\"color:#393A34\">=</span> software<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;version&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    labels<span class=\"token\" style=\"color:#393A34\">[</span>versionCnt<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;%s (%s)&#x27;</span> <span class=\"token\" style=\"color:#393A34\">%</span> <span class=\"token\" style=\"color:#393A34\">(</span>version<span class=\"token\" style=\"color:#393A34\">,</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;publicationYear&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    versionCnt <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n    \n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Initialise aggregated metric counts (key: 0)</span>\ncitationCounts<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\nviewCounts<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\ndownloadCounts<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n    \n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Populate metric counts for individual versions (key: versionCnt) and add them to the aggregated counts (key: 0)</span>\nversionCnt <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> node <span class=\"token\" style=\"color:#0000ff\">in</span> software<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;versions&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;nodes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    citationCounts<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;citationCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    viewCounts<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;viewCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    downloadCounts<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;downloadCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    citationCounts<span class=\"token\" style=\"color:#393A34\">[</span>versionCnt<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;citationCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    viewCounts<span class=\"token\" style=\"color:#393A34\">[</span>versionCnt<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;viewCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    downloadCounts<span class=\"token\" style=\"color:#393A34\">[</span>versionCnt<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;downloadCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    versionCnt <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Create stacked bar plot</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>DataFrame<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#A31515\">&#x27;Software/Versions&#x27;</span><span class=\"token\" style=\"color:#393A34\">:</span> labels<span class=\"token\" style=\"color:#393A34\">,</span>\n                   <span class=\"token\" style=\"color:#A31515\">&#x27;Citations&#x27;</span><span class=\"token\" style=\"color:#393A34\">:</span> citationCounts<span class=\"token\" style=\"color:#393A34\">,</span>\n                   <span class=\"token\" style=\"color:#A31515\">&#x27;Views&#x27;</span><span class=\"token\" style=\"color:#393A34\">:</span> viewCounts<span class=\"token\" style=\"color:#393A34\">,</span>\n                   <span class=\"token\" style=\"color:#A31515\">&#x27;Downloads&#x27;</span><span class=\"token\" style=\"color:#393A34\">:</span> downloadCounts<span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">)</span>\nfig <span class=\"token\" style=\"color:#393A34\">=</span> px_stacked_bar<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">.</span>set_index<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;Software/Versions&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> y_name <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Counts&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Set plot background to transparent</span>\nfig<span class=\"token\" style=\"color:#393A34\">.</span>update_layout<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">{</span>\n<span class=\"token\" style=\"color:#A31515\">&#x27;plot_bgcolor&#x27;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&#x27;rgba(0, 0, 0, 0)&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#A31515\">&#x27;paper_bgcolor&#x27;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&#x27;rgba(0, 0, 0, 0)&#x27;</span>\n<span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Write interactive plot out to html file</span>\npio<span class=\"token\" style=\"color:#393A34\">.</span>write_html<span class=\"token\" style=\"color:#393A34\">(</span>fig<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token,builtin\">file</span><span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;out.html&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Display plot from the saved html file</span>\ndisplay<span class=\"token\" style=\"color:#393A34\">(</span>Markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;Citations, views and downloads counts for software: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488) across all its versions, shown as stacked bar plot:&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nIFrame<span class=\"token\" style=\"color:#393A34\">(</span>src<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;./out.html&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> width<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">500</span><span class=\"token\" style=\"color:#393A34\">,</span> height<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">500</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-gzVnrw jFzGrB\"></div></div></div></div>","internal":{"content":"{\n \"cells\": [\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"  [FREYA](https://www.project-freya.eu/en) WP2 [User Story 2](https://github.com/datacite/freya/issues/63) | As a software author, I want to be able to see the citations of my software aggregated across all versions, so that I see a complete picture of reuse.\\n\",\n    \" :------------- | :------------- | :-------------\\n\",\n    \"\\n\",\n    \"Software development process involves versioned releases. Consequently, different software versions may be used for scientific discovery and thus referenced in publications. In order to quantify impact of a software, its author must be able to capture the reuse of the software across all its versions.<p />\\n\",\n    \"This notebook uses the [DataCite GraphQL API](https://api.datacite.org/graphql) to retrieve metadata about software titled: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488), including all its versions, so that its overall reuse can be quantified.\\n\",\n    \"\\n\",\n    \"**Goal**: By the end of this notebook, for a given software you should be able to display:\\n\",\n    \"- Counts of <ins>citations, views and downloads</ins> metrics, aggregated across all versions of the software\\n\",\n    \"- An interactive stacked bar plot showing how the metric counts of each version contribute to the corresponding aggregated metric counts, e.g.<br> <img src=\\\"example_plot.png\\\" width=\\\"258\\\" height=\\\"215\\\" />\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Install libraries and prepare GraphQL client\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 1,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"%%capture\\n\",\n    \"# Install required Python packages\\n\",\n    \"!pip install gql requests numpy plotly\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 2,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"# Prepare the GraphQL client\\n\",\n    \"import requests\\n\",\n    \"from IPython.display import display, Markdown\\n\",\n    \"from gql import gql, Client\\n\",\n    \"from gql.transport.requests import RequestsHTTPTransport\\n\",\n    \"\\n\",\n    \"_transport = RequestsHTTPTransport(\\n\",\n    \"    url='https://api.datacite.org/graphql',\\n\",\n    \"    use_json=True,\\n\",\n    \")\\n\",\n    \"\\n\",\n    \"client = Client(\\n\",\n    \"    transport=_transport,\\n\",\n    \"    fetch_schema_from_transport=True,\\n\",\n    \")\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Define and run GraphQL query\\n\",\n    \"Define the GraphQL query to retrieve metadata for the software titled: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488) using its DOI.\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 3,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"# Generate the GraphQL query to retrieve the required software's metadata\\n\",\n    \"query_params = {\\n\",\n    \"    \\\"softwareId\\\" : \\\"https://doi.org/10.5281/zenodo.2799488\\\"\\n\",\n    \"}\\n\",\n    \"\\n\",\n    \"query = gql(\\\"\\\"\\\"query getSoftware($softwareId: ID!)\\n\",\n    \"{\\n\",\n    \"  software(id: $softwareId) {\\n\",\n    \"    id\\n\",\n    \"    titles {\\n\",\n    \"      title\\n\",\n    \"    }\\n\",\n    \"    publicationYear\\n\",\n    \"    citations {\\n\",\n    \"      nodes {\\n\",\n    \"        id\\n\",\n    \"        titles {\\n\",\n    \"          title\\n\",\n    \"        }        \\n\",\n    \"      }\\n\",\n    \"    }\\n\",\n    \"    version\\n\",\n    \"    versionCount\\n\",\n    \"    versionOfCount\\n\",\n    \"    citationCount\\n\",\n    \"    downloadCount\\n\",\n    \"    viewCount\\n\",\n    \"    versions {\\n\",\n    \"      nodes {\\n\",\n    \"        id\\n\",\n    \"        version\\n\",\n    \"        publicationYear\\n\",\n    \"        titles {\\n\",\n    \"          title\\n\",\n    \"        }\\n\",\n    \"        citations {\\n\",\n    \"          nodes {\\n\",\n    \"            id\\n\",\n    \"            titles {\\n\",\n    \"              title\\n\",\n    \"            }\\n\",\n    \"          }\\n\",\n    \"        }\\n\",\n    \"        version\\n\",\n    \"        versionCount\\n\",\n    \"        versionOfCount\\n\",\n    \"        citationCount\\n\",\n    \"        downloadCount\\n\",\n    \"        viewCount\\n\",\n    \"      }\\n\",\n    \"    }\\n\",\n    \"  }\\n\",\n    \"}\\n\",\n    \"\\\"\\\"\\\")\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"Run the above query via the GraphQL client\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 4,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"import json\\n\",\n    \"data = client.execute(query, variable_values=json.dumps(query_params))\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Display total software metrics\\n\",\n    \"Display total number of <ins>citations, views and downloads</ins> across all versions of software: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488).\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 5,\n   \"metadata\": {},\n   \"outputs\": [\n    {\n     \"data\": {\n      \"text/markdown\": [\n       \"Aggregated metric counts for software: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488) across all its versions:\"\n      ],\n      \"text/plain\": [\n       \"<IPython.core.display.Markdown object>\"\n      ]\n     },\n     \"metadata\": {},\n     \"output_type\": \"display_data\"\n    },\n    {\n     \"data\": {\n      \"text/markdown\": [\n       \"|Metric | Aggregated Count|\\n\",\n       \"|---|---|\\n\",\n       \"citationCount | **3**\\n\",\n       \"viewCount | **0**\\n\",\n       \"downloadCount | **0**\\n\"\n      ],\n      \"text/plain\": [\n       \"<IPython.core.display.Markdown object>\"\n      ]\n     },\n     \"metadata\": {},\n     \"output_type\": \"display_data\"\n    }\n   ],\n   \"source\": [\n    \"# Get the total count per metric, aggregated for across all versions of the software\\n\",\n    \"software = data['software']\\n\",\n    \"# Initialise metric counts\\n\",\n    \"metricCounts = {}\\n\",\n    \"for metric in ['citationCount', 'viewCount', 'downloadCount']:\\n\",\n    \"    metricCounts[metric] = 0\\n\",\n    \"    \\n\",\n    \"# Aggregate metric counts across all the version\\n\",\n    \"for node in software['versions']['nodes']:\\n\",\n    \"    for metric in metricCounts:\\n\",\n    \"         metricCounts[metric] += node[metric]\\n\",\n    \"            \\n\",\n    \"# Display the aggregated metric counts\\n\",\n    \"tableBody=\\\"\\\"\\n\",\n    \"for metric in metricCounts:        \\n\",\n    \"    tableBody += \\\"%s | **%s**\\\\n\\\" % (metric, str(metricCounts[metric]))\\n\",\n    \"if tableBody:\\n\",\n    \"   display(Markdown(\\\"Aggregated metric counts for software: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488) across all its versions:\\\"))\\n\",\n    \"   display(Markdown(\\\"|Metric | Aggregated Count|\\\\n|---|---|\\\\n%s\\\" % tableBody))\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Plot metric counts per software version\\n\",\n    \"Plot stacked bar plot showing how the individual versions of software: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488) contribute their metric counts to the corresponding aggregated total.\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 6,\n   \"metadata\": {},\n   \"outputs\": [\n    {\n     \"data\": {\n      \"text/markdown\": [\n       \"Citations, views and downloads counts for software: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488) across all its versions, shown as stacked bar plot:\"\n      ],\n      \"text/plain\": [\n       \"<IPython.core.display.Markdown object>\"\n      ]\n     },\n     \"metadata\": {},\n     \"output_type\": \"display_data\"\n    },\n    {\n     \"data\": {\n      \"text/html\": [\n       \"\\n\",\n       \"        <iframe\\n\",\n       \"            width=\\\"500\\\"\\n\",\n       \"            height=\\\"500\\\"\\n\",\n       \"            src=\\\"./out.html\\\"\\n\",\n       \"            frameborder=\\\"0\\\"\\n\",\n       \"            allowfullscreen\\n\",\n       \"        ></iframe>\\n\",\n       \"        \"\n      ],\n      \"text/plain\": [\n       \"<IPython.lib.display.IFrame at 0x107a9add8>\"\n      ]\n     },\n     \"execution_count\": 6,\n     \"metadata\": {},\n     \"output_type\": \"execute_result\"\n    }\n   ],\n   \"source\": [\n    \"import plotly.io as pio\\n\",\n    \"import plotly.express as px\\n\",\n    \"from IPython.display import IFrame\\n\",\n    \"import pandas as pd\\n\",\n    \"\\n\",\n    \"# Adapted from: https://stackoverflow.com/questions/58766305/is-there-any-way-to-implement-stacked-or-grouped-bar-charts-in-plotly-express\\n\",\n    \"def px_stacked_bar(df, color_name='Metric', y_name='Metrics', **pxargs):\\n\",\n    \"    idx_col = df.index.name\\n\",\n    \"    m = pd.melt(df.reset_index(), id_vars=idx_col, var_name=color_name, value_name=y_name)\\n\",\n    \"    # For Plotly colour sequences see: https://plotly.com/python/discrete-color/     \\n\",\n    \"    return px.bar(m, x=idx_col, y=y_name, color=color_name, **pxargs, \\n\",\n    \"                  color_discrete_sequence=px.colors.qualitative.Pastel1)\\n\",\n    \"\\n\",\n    \"# Collect metric counts\\n\",\n    \"software = data['software']\\n\",\n    \"version = software['version']\\n\",\n    \"\\n\",\n    \"# Initialise dicts for the stacked bar plot\\n\",\n    \"labels = {0: 'All Software Versions'}\\n\",\n    \"citationCounts = {}\\n\",\n    \"viewCounts = {}\\n\",\n    \"downloadCounts = {}\\n\",\n    \"\\n\",\n    \"# Collect software/version labels\\n\",\n    \"versionCnt = 1\\n\",\n    \"for node in software['versions']['nodes']:\\n\",\n    \"    version = software['version']\\n\",\n    \"    labels[versionCnt] = '%s (%s)' % (version, node['publicationYear'])\\n\",\n    \"    versionCnt += 1\\n\",\n    \"    \\n\",\n    \"# Initialise aggregated metric counts (key: 0)\\n\",\n    \"citationCounts[0] = 0\\n\",\n    \"viewCounts[0] = 0\\n\",\n    \"downloadCounts[0] = 0\\n\",\n    \"    \\n\",\n    \"# Populate metric counts for individual versions (key: versionCnt) and add them to the aggregated counts (key: 0)\\n\",\n    \"versionCnt = 1\\n\",\n    \"for node in software['versions']['nodes']:\\n\",\n    \"    citationCounts[0] += node['citationCount']\\n\",\n    \"    viewCounts[0] += node['viewCount']\\n\",\n    \"    downloadCounts[0] += node['downloadCount']\\n\",\n    \"    citationCounts[versionCnt] = node['citationCount']\\n\",\n    \"    viewCounts[versionCnt] = node['viewCount']\\n\",\n    \"    downloadCounts[versionCnt] = node['downloadCount']\\n\",\n    \"    versionCnt += 1\\n\",\n    \"\\n\",\n    \"# Create stacked bar plot\\n\",\n    \"df = pd.DataFrame({'Software/Versions': labels,\\n\",\n    \"                   'Citations': citationCounts,\\n\",\n    \"                   'Views': viewCounts,\\n\",\n    \"                   'Downloads': downloadCounts})\\n\",\n    \"fig = px_stacked_bar(df.set_index('Software/Versions'), y_name = \\\"Counts\\\")\\n\",\n    \"\\n\",\n    \"# Set plot background to transparent\\n\",\n    \"fig.update_layout({\\n\",\n    \"'plot_bgcolor': 'rgba(0, 0, 0, 0)',\\n\",\n    \"'paper_bgcolor': 'rgba(0, 0, 0, 0)'\\n\",\n    \"})\\n\",\n    \"\\n\",\n    \"# Write interactive plot out to html file\\n\",\n    \"pio.write_html(fig, file='out.html')\\n\",\n    \"\\n\",\n    \"# Display plot from the saved html file\\n\",\n    \"display(Markdown(\\\"Citations, views and downloads counts for software: [Calculation Package: Inverting topography for landscape evolution model process representation](https://doi.org/10.5281/zenodo.2799488) across all its versions, shown as stacked bar plot:\\\"))\\n\",\n    \"IFrame(src=\\\"./out.html\\\", width=500, height=500)\"\n   ]\n  }\n ],\n \"metadata\": {\n  \"kernelspec\": {\n   \"display_name\": \"Python 3\",\n   \"language\": \"python\",\n   \"name\": \"python3\"\n  },\n  \"language_info\": {\n   \"codemirror_mode\": {\n    \"name\": \"ipython\",\n    \"version\": 3\n   },\n   \"file_extension\": \".py\",\n   \"mimetype\": \"text/x-python\",\n   \"name\": \"python\",\n   \"nbconvert_exporter\": \"python\",\n   \"pygments_lexer\": \"ipython3\",\n   \"version\": \"3.6.1\"\n  }\n },\n \"nbformat\": 4,\n \"nbformat_minor\": 4\n}\n"},"fields":{"codemeta":{"identifier":"https://doi.org/10.14454/27b7-9g84","codeRepository":"https://github.com/datacite/pidgraph-notebooks-python/tree/master/user-story-2-software-citations","controlledTem":"software","datePublished":"2020-06-01","dateModified":"2020-06-10","dateCreated":"2020-06-01","description":"Jupyter notebook that uses GraphQL to implement EC-funded FREYA Project User Story 2: As a software author, I want to be able to see the citations of my software aggregated across all versions. so that I see a complete picture of reuse.","isAutomatedBuild":true,"issueTracker":"https://github.com/datacite/pidgraph-notebooks-python/issues","licenseId":"MIT","publisher":"DataCite","name":"FREYA PID Graph - Software Citations","version":"1.1.1"}}}},"pageContext":{"slug":"/pidgraph-notebooks-python/user-story-2-software-citations/py-software-citations-with-output/"}}}