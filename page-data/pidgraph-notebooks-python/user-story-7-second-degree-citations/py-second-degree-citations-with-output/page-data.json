{"componentChunkName":"component---src-templates-notebook-js","path":"/pidgraph-notebooks-python/user-story-7-second-degree-citations/py-second-degree-citations-with-output/","result":{"data":{"jupyterNotebook":{"html":"<div class=\"notebook-render\"><div class=\"sc-iwsKbI Dticx\"><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><table>\n<thead>\n<tr>\n<th><a>FREYA</a></th>\n<th>WP2 <a>User Story 7</a>: As a data center, I want to see the citations of publications that use my repository for the underlying data, so that I can demonstrate the impact of our repository.</th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n</tbody>\n</table>\n<p>It is important for repositories of scientific data to monitor and report on the impact of the data they store. One useful proxy of that impact are secondary citations, i.e. citations of publications which use the deposited data. This notebook focuses on visualisation of these citations by means of a force-directed graph.\nThis notebook uses the <a>DataCite GraphQL API</a> to retrieve the citations of the following different datasets: </p>\n<ul>\n<li><a>Effects of varying food-availability on ecology and distribution of smallest benthic organisms in sediments of the arctic Fram Strait during POLARSTERN cruise ARK-XV/2, supplement to: Schewe, Ingo; Soltwedel, Thomas (2003): Benthic response to ice-edge-induced particle flux in the Arctic Ocean. Polar Biology, 26(9), 610-620</a>;</li>\n<li><a>Data from: Towards a worldwide wood economics spectrum</a>; and</li>\n<li><a>rmca-albertine-rift-cichlids</a>.</li>\n</ul>\n<p><strong>Goal</strong>: By the end of this notebook, for a given list of datasets, you should be able to display:</p>\n<ul>\n<li>Total citation count for each retrieved dataset;</li>\n<li>An interactive force-directed graph of the datasets and their citations, in which:</li>\n<li>Pink nodes at the centre of each radial shape corresponds to a dataset;</li>\n<li>Blue nodes correspond to citations (note that some citations may be shared by more than one dataset);</li>\n<li>Larger node size represents more citations of the dataset or citation represented by that node. Note that to increase node visibility, node sizes between datasets and citations are not comparable to each other.</li>\n</ul></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Install libraries and prepare GraphQL client</h2></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[123]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#393A34\">%</span><span class=\"token\" style=\"color:#393A34\">%</span>capture\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Install required Python packages</span>\n!pip install gql requests pyvis jsonpickle</code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[124]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Prepare the GraphQL client</span>\n<span class=\"token\" style=\"color:#0000ff\">import</span> requests\n<span class=\"token\" style=\"color:#0000ff\">from</span> IPython<span class=\"token\" style=\"color:#393A34\">.</span>display <span class=\"token\" style=\"color:#0000ff\">import</span> display<span class=\"token\" style=\"color:#393A34\">,</span> Markdown\n<span class=\"token\" style=\"color:#0000ff\">from</span> gql <span class=\"token\" style=\"color:#0000ff\">import</span> gql<span class=\"token\" style=\"color:#393A34\">,</span> Client\n<span class=\"token\" style=\"color:#0000ff\">from</span> gql<span class=\"token\" style=\"color:#393A34\">.</span>transport<span class=\"token\" style=\"color:#393A34\">.</span>requests <span class=\"token\" style=\"color:#0000ff\">import</span> RequestsHTTPTransport\n\n_transport <span class=\"token\" style=\"color:#393A34\">=</span> RequestsHTTPTransport<span class=\"token\" style=\"color:#393A34\">(</span>\n    url<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;https://api.datacite.org/graphql&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    use_json<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\n\nclient <span class=\"token\" style=\"color:#393A34\">=</span> Client<span class=\"token\" style=\"color:#393A34\">(</span>\n    transport<span class=\"token\" style=\"color:#393A34\">=</span>_transport<span class=\"token\" style=\"color:#393A34\">,</span>\n    fetch_schema_from_transport<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Define and run GraphQL query</h2>\n<p>Define the GraphQL query to find all publications including co-authors for <a>Dr Sarah Teichmann</a>:</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[119]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Generate the GraphQL query to retrieve up to 100 researchers matching query &quot;John and Smith&quot;</span>\nquery_params <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;ids&quot;</span> <span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;10.5061/dryad.234&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#A31515\">&quot;10.15468/n6ftyd&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#A31515\">&quot;10.1594/pangaea.314690&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#393A34\">}</span>\n\nquery <span class=\"token\" style=\"color:#393A34\">=</span> gql<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token,triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;query getDatasetCitations($ids: [String!]) {\n  datasets(ids: $ids) {\n    nodes {\n      id\n      titles {\n        title\n      }\n      citationCount\n      citations {\n        nodes {\n          id\n          publisher\n          titles {\n            title\n          }\n          citationCount\n        }\n      }\n    }\n  }\n}\n\n\n&quot;&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><p>Run the above query via the GraphQL client</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[120]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> json\ndata <span class=\"token\" style=\"color:#393A34\">=</span> client<span class=\"token\" style=\"color:#393A34\">.</span>execute<span class=\"token\" style=\"color:#393A34\">(</span>query<span class=\"token\" style=\"color:#393A34\">,</span> variable_values<span class=\"token\" style=\"color:#393A34\">=</span>json<span class=\"token\" style=\"color:#393A34\">.</span>dumps<span class=\"token\" style=\"color:#393A34\">(</span>query_params<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Display total number of citations per dataset</h2></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[131]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Get total citation counts for each dataset in the query</span>\ndatasets <span class=\"token\" style=\"color:#393A34\">=</span> data<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;datasets&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\ntableBody<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> dataset <span class=\"token\" style=\"color:#0000ff\">in</span> datasets<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;nodes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token,builtin\">id</span> <span class=\"token\" style=\"color:#393A34\">=</span> dataset<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;id&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    doi <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;/&quot;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token,builtin\">id</span><span class=\"token\" style=\"color:#393A34\">.</span>split<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;/&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">3</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    titles <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> title <span class=\"token\" style=\"color:#0000ff\">in</span> dataset<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;titles&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        titles<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>title<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;title&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    citationCount <span class=\"token\" style=\"color:#393A34\">=</span> dataset<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;citationCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    tableBody <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#A31515\">&quot;[%s](%s) | [**%s**](%s/%s)\\n&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> <span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;, &#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>titles<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token,builtin\">id</span><span class=\"token\" style=\"color:#393A34\">,</span> citationCount<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;https://search.datacite.org/works&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>doi<span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">if</span> tableBody<span class=\"token\" style=\"color:#393A34\">:</span>\n    display<span class=\"token\" style=\"color:#393A34\">(</span>Markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;| Dataset | Citation Count|\\n|---|---|\\n%s&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> tableBody<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>  </code></pre></div><div class=\"sc-gzVnrw jFzGrB\"></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Plot a force-directed graph connecting datasets to their publications and citations of those publications</h2>\n<p>Plot an interactive force-directed graph of connecting the datasets to their citations (first-degree) and the citations of those citations (second-degree).</p>\n<ul>\n<li>Pink nodes at the centre of each radial shape corresponds to a dataset;</li>\n<li>Blue nodes correspond to citations (note that some citations may be shared by more than one dataset);</li>\n<li>Larger node size represents more citations of the dataset or citation represented by that node. Note that to increase node visibility, node sizes between datasets and citations are not comparable to each other.</li>\n</ul></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[135]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> pyvis<span class=\"token\" style=\"color:#393A34\">.</span>network <span class=\"token\" style=\"color:#0000ff\">import</span> Network\n<span class=\"token\" style=\"color:#0000ff\">import</span> pandas <span class=\"token\" style=\"color:#0000ff\">as</span> pd\n<span class=\"token\" style=\"color:#0000ff\">from</span> IPython<span class=\"token\" style=\"color:#393A34\">.</span>display <span class=\"token\" style=\"color:#0000ff\">import</span> IFrame\n<span class=\"token\" style=\"color:#0000ff\">import</span> math\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Colour swatch for the network nodes</span>\ndataset_node_colour <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;#FB8072&quot;</span>\ncitation_node_colour <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;#80B1D3&quot;</span>\n\ngot_net <span class=\"token\" style=\"color:#393A34\">=</span> Network<span class=\"token\" style=\"color:#393A34\">(</span>height<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;750px&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> width<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;100%&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> bgcolor<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;#ffffff&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> font_color<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;black&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> notebook<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\ngot_net<span class=\"token\" style=\"color:#393A34\">.</span>options<span class=\"token\" style=\"color:#393A34\">.</span>edges<span class=\"token\" style=\"color:#393A34\">.</span>inherit_colors<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">False</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># set the physics layout of the network</span>\ngot_net<span class=\"token\" style=\"color:#393A34\">.</span>barnes_hut<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># ------------------------------</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Initialise intermediate data structure to store: (src, trg) -&gt; citation count of the target, where:</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># src - dataset or citation; trg - citation</span>\nsrcTrg2Count <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Initialise intermediate data structure to store: src --&gt; Set of connected trg&#x27;s</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Note that the number of connected trgs will determine the colour of each src</span>\nsrc2OtherTrgs <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\n\ndatasets <span class=\"token\" style=\"color:#393A34\">=</span> data<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;datasets&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Populate srcTrg2Count</span>\nallNodes <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token,builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> node <span class=\"token\" style=\"color:#0000ff\">in</span> datasets<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;nodes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    nodeSet <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token,builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    datasetDOI <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;/&quot;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;id&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>split<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;/&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">3</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    nodeSet<span class=\"token\" style=\"color:#393A34\">.</span>add<span class=\"token\" style=\"color:#393A34\">(</span>datasetDOI<span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> citation <span class=\"token\" style=\"color:#0000ff\">in</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;citations&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;nodes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        citationDOI <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;/&quot;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>citation<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;id&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>split<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;/&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">3</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        citationCount <span class=\"token\" style=\"color:#393A34\">=</span> citation<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;citationCount&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        nodeSet<span class=\"token\" style=\"color:#393A34\">.</span>add<span class=\"token\" style=\"color:#393A34\">(</span>citationDOI<span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> datasetDOI <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> src2OtherTrgs<span class=\"token\" style=\"color:#393A34\">:</span>\n            src2OtherTrgs<span class=\"token\" style=\"color:#393A34\">[</span>datasetDOI<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token,builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        src2OtherTrgs<span class=\"token\" style=\"color:#393A34\">[</span>datasetDOI<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>add<span class=\"token\" style=\"color:#393A34\">(</span>citationDOI<span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> citationDOI <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> src2OtherTrgs<span class=\"token\" style=\"color:#393A34\">:</span>\n            src2OtherTrgs<span class=\"token\" style=\"color:#393A34\">[</span>citationDOI<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token,builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>   \n        src2OtherTrgs<span class=\"token\" style=\"color:#393A34\">[</span>citationDOI<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>add<span class=\"token\" style=\"color:#393A34\">(</span>datasetDOI<span class=\"token\" style=\"color:#393A34\">)</span>        \n        srcTrg2Count<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>datasetDOI<span class=\"token\" style=\"color:#393A34\">,</span> citationDOI<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> citationCount     \n    nodes <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token,builtin\">sorted</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token,builtin\">list</span><span class=\"token\" style=\"color:#393A34\">(</span>nodeSet<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    allNodes<span class=\"token\" style=\"color:#393A34\">.</span>update<span class=\"token\" style=\"color:#393A34\">(</span>nodes<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Populate data structures needed for the graph</span>\nsources<span class=\"token\" style=\"color:#393A34\">,</span> targets<span class=\"token\" style=\"color:#393A34\">,</span> weights <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> <span class=\"token,builtin\">tuple</span> <span class=\"token\" style=\"color:#0000ff\">in</span> srcTrg2Count<span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> srcTrg2Count<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token,builtin\">tuple</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">&gt;=</span> <span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        sources<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token,builtin\">tuple</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        targets<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token,builtin\">tuple</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        weights<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>srcTrg2Count<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token,builtin\">tuple</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\nedge_data <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token,builtin\">zip</span><span class=\"token\" style=\"color:#393A34\">(</span>sources<span class=\"token\" style=\"color:#393A34\">,</span> targets<span class=\"token\" style=\"color:#393A34\">,</span> weights<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">for</span> e <span class=\"token\" style=\"color:#0000ff\">in</span> edge_data<span class=\"token\" style=\"color:#393A34\">:</span>\n    src <span class=\"token\" style=\"color:#393A34\">=</span> e<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    dst <span class=\"token\" style=\"color:#393A34\">=</span> e<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    w <span class=\"token\" style=\"color:#393A34\">=</span> e<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    src_node_size <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">5</span> <span class=\"token\" style=\"color:#393A34\">*</span> math<span class=\"token\" style=\"color:#393A34\">.</span>log2<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token,builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>src2OtherTrgs<span class=\"token\" style=\"color:#393A34\">[</span>src<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">*</span> <span class=\"token\" style=\"color:#36acaa\">5000</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    got_net<span class=\"token\" style=\"color:#393A34\">.</span>add_node<span class=\"token\" style=\"color:#393A34\">(</span>src<span class=\"token\" style=\"color:#393A34\">,</span> src<span class=\"token\" style=\"color:#393A34\">,</span> title<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;Dataset: %s;&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> src<span class=\"token\" style=\"color:#393A34\">,</span> color<span class=\"token\" style=\"color:#393A34\">=</span>dataset_node_colour<span class=\"token\" style=\"color:#393A34\">,</span> size<span class=\"token\" style=\"color:#393A34\">=</span>src_node_size<span class=\"token\" style=\"color:#393A34\">)</span>   \n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># We&#x27;re adding 1 below to make edges representing 0 citations of the target appear in the force-directed graph   </span>\n    dst_node_size <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">10</span> <span class=\"token\" style=\"color:#393A34\">*</span> math<span class=\"token\" style=\"color:#393A34\">.</span>log2<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span>w<span class=\"token\" style=\"color:#393A34\">+</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">*</span> <span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    got_net<span class=\"token\" style=\"color:#393A34\">.</span>add_node<span class=\"token\" style=\"color:#393A34\">(</span>dst<span class=\"token\" style=\"color:#393A34\">,</span> dst<span class=\"token\" style=\"color:#393A34\">,</span> title<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;Citation: %s; Number of citations: %d;&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> <span class=\"token\" style=\"color:#393A34\">(</span>dst<span class=\"token\" style=\"color:#393A34\">,</span> w<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> color<span class=\"token\" style=\"color:#393A34\">=</span>citation_node_colour<span class=\"token\" style=\"color:#393A34\">,</span> size<span class=\"token\" style=\"color:#393A34\">=</span>dst_node_size<span class=\"token\" style=\"color:#393A34\">)</span>\n    got_net<span class=\"token\" style=\"color:#393A34\">.</span>add_edge<span class=\"token\" style=\"color:#393A34\">(</span>src<span class=\"token\" style=\"color:#393A34\">,</span> dst<span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    \nneighbor_map <span class=\"token\" style=\"color:#393A34\">=</span> got_net<span class=\"token\" style=\"color:#393A34\">.</span>get_adj_list<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># add neighbor data to node hover data</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> node <span class=\"token\" style=\"color:#0000ff\">in</span> got_net<span class=\"token\" style=\"color:#393A34\">.</span>nodes<span class=\"token\" style=\"color:#393A34\">:</span>\n    node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;title&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#A31515\">&quot; Neighbours:&lt;br&gt;&quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot;&lt;br&gt;&quot;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>neighbor_map<span class=\"token\" style=\"color:#393A34\">[</span>node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;id&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\ngot_net<span class=\"token\" style=\"color:#393A34\">.</span>show<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;out.html&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay<span class=\"token\" style=\"color:#393A34\">(</span>Markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;N.B. Click on the plot, then use down/up mouse scroll to zoom in/out respectively.&lt;br&gt;When zoomed in, you will notice the DOI label against each node.&lt;br&gt;Click on any node to see the list of &#x27;neighbour&#x27; citations, and on the citation node to also see the number of its citations.&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nIFrame<span class=\"token\" style=\"color:#393A34\">(</span>src<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;./out.html&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> width<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1000</span><span class=\"token\" style=\"color:#393A34\">,</span> height<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">800</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-gzVnrw jFzGrB\"></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"></code></pre></div></div></div></div>","internal":{"content":"{\n \"cells\": [\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \" [FREYA](https://www.project-freya.eu/en) | WP2 [User Story 7]( https://www.pidforum.org/t/pid-graph-graphql-example-second-degree-citations/939): As a data center, I want to see the citations of publications that use my repository for the underlying data, so that I can demonstrate the impact of our repository.\\n\",\n    \":------------- | :------------- | :-------------\\n\",\n    \"\\n\",\n    \"It is important for repositories of scientific data to monitor and report on the impact of the data they store. One useful proxy of that impact are secondary citations, i.e. citations of publications which use the deposited data. This notebook focuses on visualisation of these citations by means of a force-directed graph.<p />\\n\",\n    \"This notebook uses the [DataCite GraphQL API](https://api.datacite.org/graphql) to retrieve the citations of the following different datasets: \\n\",\n    \"- [Effects of varying food-availability on ecology and distribution of smallest benthic organisms in sediments of the arctic Fram Strait during POLARSTERN cruise ARK-XV/2, supplement to: Schewe, Ingo; Soltwedel, Thomas (2003): Benthic response to ice-edge-induced particle flux in the Arctic Ocean. Polar Biology, 26(9), 610-620](https://doi.org/10.1594/pangaea.314690);\\n\",\n    \"- [Data from: Towards a worldwide wood economics spectrum](https://doi.org/10.5061/dryad.234); and\\n\",\n    \"- [rmca-albertine-rift-cichlids](https://doi.org/10.15468/n6ftyd).\\n\",\n    \"\\n\",\n    \"**Goal**: By the end of this notebook, for a given list of datasets, you should be able to display:\\n\",\n    \"- Total citation count for each retrieved dataset;\\n\",\n    \"- An interactive force-directed graph of the datasets and their citations, in which:\\n\",\n    \" - Pink nodes at the centre of each radial shape corresponds to a dataset;\\n\",\n    \" - Blue nodes correspond to citations (note that some citations may be shared by more than one dataset);\\n\",\n    \" - Larger node size represents more citations of the dataset or citation represented by that node. Note that to increase node visibility, node sizes between datasets and citations are not comparable to each other.\\n\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Install libraries and prepare GraphQL client\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 123,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"%%capture\\n\",\n    \"# Install required Python packages\\n\",\n    \"!pip install gql requests pyvis jsonpickle\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 124,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"# Prepare the GraphQL client\\n\",\n    \"import requests\\n\",\n    \"from IPython.display import display, Markdown\\n\",\n    \"from gql import gql, Client\\n\",\n    \"from gql.transport.requests import RequestsHTTPTransport\\n\",\n    \"\\n\",\n    \"_transport = RequestsHTTPTransport(\\n\",\n    \"    url='https://api.datacite.org/graphql',\\n\",\n    \"    use_json=True,\\n\",\n    \")\\n\",\n    \"\\n\",\n    \"client = Client(\\n\",\n    \"    transport=_transport,\\n\",\n    \"    fetch_schema_from_transport=True,\\n\",\n    \")\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Define and run GraphQL query\\n\",\n    \"Define the GraphQL query to find all publications including co-authors for [Dr Sarah Teichmann](https://orcid.org/0000-0002-6294-6366):\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 119,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"# Generate the GraphQL query to retrieve up to 100 researchers matching query \\\"John and Smith\\\"\\n\",\n    \"query_params = {\\n\",\n    \"    \\\"ids\\\" : [\\\"10.5061/dryad.234\\\",\\\"10.15468/n6ftyd\\\",\\\"10.1594/pangaea.314690\\\"]\\n\",\n    \"}\\n\",\n    \"\\n\",\n    \"query = gql(\\\"\\\"\\\"query getDatasetCitations($ids: [String!]) {\\n\",\n    \"  datasets(ids: $ids) {\\n\",\n    \"    nodes {\\n\",\n    \"      id\\n\",\n    \"      titles {\\n\",\n    \"        title\\n\",\n    \"      }\\n\",\n    \"      citationCount\\n\",\n    \"      citations {\\n\",\n    \"        nodes {\\n\",\n    \"          id\\n\",\n    \"          publisher\\n\",\n    \"          titles {\\n\",\n    \"            title\\n\",\n    \"          }\\n\",\n    \"          citationCount\\n\",\n    \"        }\\n\",\n    \"      }\\n\",\n    \"    }\\n\",\n    \"  }\\n\",\n    \"}\\n\",\n    \"\\n\",\n    \"\\n\",\n    \"\\\"\\\"\\\")\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"Run the above query via the GraphQL client\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 120,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"import json\\n\",\n    \"data = client.execute(query, variable_values=json.dumps(query_params))\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Display total number of citations per dataset\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 131,\n   \"metadata\": {},\n   \"outputs\": [\n    {\n     \"data\": {\n      \"text/markdown\": [\n       \"| Dataset | Citation Count|\\n\",\n       \"|---|---|\\n\",\n       \"[Effects of varying food-availability on ecology and distribution of smallest benthic organisms in sediments of the arctic Fram Strait during POLARSTERN cruise ARK-XV/2, supplement to: Schewe, Ingo; Soltwedel, Thomas (2003): Benthic response to ice-edge-induced particle flux in the Arctic Ocean. Polar Biology, 26(9), 610-620](https://doi.org/10.1594/pangaea.314690) | [**164**](https://search.datacite.org/works/10.1594/pangaea.314690)\\n\",\n       \"[Data from: Towards a worldwide wood economics spectrum](https://doi.org/10.5061/dryad.234) | [**4**](https://search.datacite.org/works/10.5061/dryad.234)\\n\",\n       \"[rmca-albertine-rift-cichlids](https://doi.org/10.15468/n6ftyd) | [**150**](https://search.datacite.org/works/10.15468/n6ftyd)\\n\"\n      ],\n      \"text/plain\": [\n       \"<IPython.core.display.Markdown object>\"\n      ]\n     },\n     \"metadata\": {},\n     \"output_type\": \"display_data\"\n    }\n   ],\n   \"source\": [\n    \"# Get total citation counts for each dataset in the query\\n\",\n    \"datasets = data['datasets']\\n\",\n    \"tableBody=\\\"\\\"\\n\",\n    \"for dataset in datasets['nodes']:\\n\",\n    \"    id = dataset['id']\\n\",\n    \"    doi = \\\"/\\\".join(id.split(\\\"/\\\")[3:])\\n\",\n    \"    titles = []\\n\",\n    \"    for title in dataset['titles']:\\n\",\n    \"        titles.append(title['title'])\\n\",\n    \"    citationCount = dataset['citationCount']\\n\",\n    \"    tableBody += \\\"[%s](%s) | [**%s**](%s/%s)\\\\n\\\" % (', '.join(titles), id, citationCount, \\\"https://search.datacite.org/works\\\",doi)\\n\",\n    \"if tableBody:\\n\",\n    \"    display(Markdown(\\\"| Dataset | Citation Count|\\\\n|---|---|\\\\n%s\\\" % tableBody))  \"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Plot a force-directed graph connecting datasets to their publications and citations of those publications\\n\",\n    \"Plot an interactive force-directed graph of connecting the datasets to their citations (first-degree) and the citations of those citations (second-degree).\\n\",\n    \" - Pink nodes at the centre of each radial shape corresponds to a dataset;\\n\",\n    \" - Blue nodes correspond to citations (note that some citations may be shared by more than one dataset);\\n\",\n    \" - Larger node size represents more citations of the dataset or citation represented by that node. Note that to increase node visibility, node sizes between datasets and citations are not comparable to each other.\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 135,\n   \"metadata\": {},\n   \"outputs\": [\n    {\n     \"data\": {\n      \"text/markdown\": [\n       \"N.B. Click on the plot, then use down/up mouse scroll to zoom in/out respectively.<br>When zoomed in, you will notice the DOI label against each node.<br>Click on any node to see the list of 'neighbour' citations, and on the citation node to also see the number of its citations.\"\n      ],\n      \"text/plain\": [\n       \"<IPython.core.display.Markdown object>\"\n      ]\n     },\n     \"metadata\": {},\n     \"output_type\": \"display_data\"\n    },\n    {\n     \"data\": {\n      \"text/html\": [\n       \"\\n\",\n       \"        <iframe\\n\",\n       \"            width=\\\"1000\\\"\\n\",\n       \"            height=\\\"800\\\"\\n\",\n       \"            src=\\\"./out.html\\\"\\n\",\n       \"            frameborder=\\\"0\\\"\\n\",\n       \"            allowfullscreen\\n\",\n       \"        ></iframe>\\n\",\n       \"        \"\n      ],\n      \"text/plain\": [\n       \"<IPython.lib.display.IFrame at 0x12717dcf8>\"\n      ]\n     },\n     \"execution_count\": 135,\n     \"metadata\": {},\n     \"output_type\": \"execute_result\"\n    }\n   ],\n   \"source\": [\n    \"from pyvis.network import Network\\n\",\n    \"import pandas as pd\\n\",\n    \"from IPython.display import IFrame\\n\",\n    \"import math\\n\",\n    \"\\n\",\n    \"# Colour swatch for the network nodes\\n\",\n    \"dataset_node_colour = \\\"#FB8072\\\"\\n\",\n    \"citation_node_colour = \\\"#80B1D3\\\"\\n\",\n    \"\\n\",\n    \"got_net = Network(height=\\\"750px\\\", width=\\\"100%\\\", bgcolor=\\\"#ffffff\\\", font_color=\\\"black\\\", notebook=True)\\n\",\n    \"got_net.options.edges.inherit_colors(False)\\n\",\n    \"\\n\",\n    \"# set the physics layout of the network\\n\",\n    \"got_net.barnes_hut()\\n\",\n    \"\\n\",\n    \"# ------------------------------\\n\",\n    \"# Initialise intermediate data structure to store: (src, trg) -> citation count of the target, where:\\n\",\n    \"# src - dataset or citation; trg - citation\\n\",\n    \"srcTrg2Count = {}\\n\",\n    \"# Initialise intermediate data structure to store: src --> Set of connected trg's\\n\",\n    \"# Note that the number of connected trgs will determine the colour of each src\\n\",\n    \"src2OtherTrgs = {}\\n\",\n    \"\\n\",\n    \"datasets = data['datasets']\\n\",\n    \"\\n\",\n    \"# Populate srcTrg2Count\\n\",\n    \"allNodes = set()\\n\",\n    \"for node in datasets['nodes']:\\n\",\n    \"    nodeSet = set()\\n\",\n    \"    datasetDOI = \\\"/\\\".join(node['id'].split(\\\"/\\\")[3:])\\n\",\n    \"    nodeSet.add(datasetDOI)\\n\",\n    \"    for citation in node['citations']['nodes']:\\n\",\n    \"        citationDOI = \\\"/\\\".join(citation['id'].split(\\\"/\\\")[3:])\\n\",\n    \"        citationCount = citation['citationCount']\\n\",\n    \"        nodeSet.add(citationDOI)\\n\",\n    \"        if datasetDOI not in src2OtherTrgs:\\n\",\n    \"            src2OtherTrgs[datasetDOI] = set()\\n\",\n    \"        src2OtherTrgs[datasetDOI].add(citationDOI)\\n\",\n    \"        if citationDOI not in src2OtherTrgs:\\n\",\n    \"            src2OtherTrgs[citationDOI] = set()   \\n\",\n    \"        src2OtherTrgs[citationDOI].add(datasetDOI)        \\n\",\n    \"        srcTrg2Count[(datasetDOI, citationDOI)] = citationCount     \\n\",\n    \"    nodes = sorted(list(nodeSet))\\n\",\n    \"    allNodes.update(nodes)\\n\",\n    \"\\n\",\n    \"# Populate data structures needed for the graph\\n\",\n    \"sources, targets, weights = [], [], []\\n\",\n    \"for tuple in srcTrg2Count:\\n\",\n    \"    if srcTrg2Count[tuple] >= 0:\\n\",\n    \"        sources.append(tuple[0])\\n\",\n    \"        targets.append(tuple[1])\\n\",\n    \"        weights.append(srcTrg2Count[tuple])\\n\",\n    \"\\n\",\n    \"edge_data = zip(sources, targets, weights)\\n\",\n    \"\\n\",\n    \"for e in edge_data:\\n\",\n    \"    src = e[0]\\n\",\n    \"    dst = e[1]\\n\",\n    \"    w = e[2]\\n\",\n    \"    src_node_size = 5 * math.log2(len(src2OtherTrgs[src]) * 5000)\\n\",\n    \"    got_net.add_node(src, src, title=\\\"Dataset: %s;\\\" % src, color=dataset_node_colour, size=src_node_size)   \\n\",\n    \"    # We're adding 1 below to make edges representing 0 citations of the target appear in the force-directed graph   \\n\",\n    \"    dst_node_size = 10 * math.log2((w+1) * 10)\\n\",\n    \"    got_net.add_node(dst, dst, title=\\\"Citation: %s; Number of citations: %d;\\\" % (dst, w), color=citation_node_colour, size=dst_node_size)\\n\",\n    \"    got_net.add_edge(src, dst, value=1)\\n\",\n    \"    \\n\",\n    \"neighbor_map = got_net.get_adj_list()\\n\",\n    \"# add neighbor data to node hover data\\n\",\n    \"for node in got_net.nodes:\\n\",\n    \"    node[\\\"title\\\"] += \\\" Neighbours:<br>\\\" + \\\"<br>\\\".join(neighbor_map[node[\\\"id\\\"]])\\n\",\n    \"\\n\",\n    \"got_net.show(\\\"out.html\\\")\\n\",\n    \"display(Markdown(\\\"N.B. Click on the plot, then use down/up mouse scroll to zoom in/out respectively.<br>When zoomed in, you will notice the DOI label against each node.<br>Click on any node to see the list of 'neighbour' citations, and on the citation node to also see the number of its citations.\\\"))\\n\",\n    \"IFrame(src=\\\"./out.html\\\", width=1000, height=800)\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": []\n  }\n ],\n \"metadata\": {\n  \"kernelspec\": {\n   \"display_name\": \"Python 3\",\n   \"language\": \"python\",\n   \"name\": \"python3\"\n  },\n  \"language_info\": {\n   \"codemirror_mode\": {\n    \"name\": \"ipython\",\n    \"version\": 3\n   },\n   \"file_extension\": \".py\",\n   \"mimetype\": \"text/x-python\",\n   \"name\": \"python\",\n   \"nbconvert_exporter\": \"python\",\n   \"pygments_lexer\": \"ipython3\",\n   \"version\": \"3.6.1\"\n  }\n },\n \"nbformat\": 4,\n \"nbformat_minor\": 4\n}\n"},"fields":{"codemeta":{"identifier":"10.14454/xw22-0w50","codeRepository":"https://github.com/datacite/pidgraph-notebooks-python/tree/master/user-story-7-second-degree-citations","controlledTem":"software","datePublished":"2020-06-26","dateModified":"2020-06-26","dateCreated":"2020-06-26","description":"Jupyter notebook that uses GraphQL to implement EC-funded FREYA Project User Story 7: As a data center, I want to see the citations of publications that use my repository for the underlying data, so that I can demonstrate the impact of our repository.","isAutomatedBuild":true,"issueTracker":"https://github.com/datacite/pidgraph-notebooks-python/issues","licenseId":"MIT","publisher":"DataCite","name":"FREYA PID Graph - Researcher Co-authors","version":"1.1.1"}}}},"pageContext":{"slug":"/pidgraph-notebooks-python/user-story-7-second-degree-citations/py-second-degree-citations-with-output/"}}}