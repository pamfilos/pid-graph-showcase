{"componentChunkName":"component---src-templates-notebook-js","path":"/pidgraph-notebooks-python/user-story-6-disambiguate-researchers/py-disambiguate-researchers-with-output/","result":{"data":{"jupyterNotebook":{"html":"<div class=\"notebook-render\"><div class=\"sc-iwsKbI Dticx\"><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><table>\n<thead>\n<tr>\n<th><a>FREYA</a></th>\n<th>WP2 <a>User Story 6</a>: As a researcher, I am looking for more information about another researcher with a common name, but donâ€™t know his/her ORCID ID.</th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n</tbody>\n</table>\n<p>It is important to be able to locate a researcher of interest even though their ORCID ID is unknown. For example, a reader of a scientific publication may wish to find out more about one of the authors, whereby the publisher has not cross-referenced that author&#x27;s name to ORCID.</p>\n<p>This notebook uses the <a>DataCite GraphQL API</a> to disambiguate a researcher name via a <em>funnel</em> approach:</p>\n<ul>\n<li>First all researcher records matching query &quot;John AND Smith&quot; and retrieved, and an alphabetically sorted list of affiliations and the corresponding researcher names is displayed;</li>\n<li>Then the notebook simulates the user selecting one of the affiliations (in our case &quot;University of Arizona&quot;), and then performs a more detailed query: &quot;John AND Smith AND University of Arizona&quot;. The second query retrieves and displays a much smaller set of results, now also containing the researcher&#x27;s publications, thus helping the user pinpoint the researcher of interest more easily.</li>\n</ul>\n<p><strong>Goal</strong>: By the end of this notebook, you should be able successfully disambiguate a researcher name of interest.</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Install libraries and prepare GraphQL client</h2></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[228]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#393A34\">%</span><span class=\"token\" style=\"color:#393A34\">%</span>capture\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Install required Python packages</span>\n!pip install gql requests</code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[229]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Prepare the GraphQL client</span>\n<span class=\"token\" style=\"color:#0000ff\">import</span> requests\n<span class=\"token\" style=\"color:#0000ff\">from</span> IPython<span class=\"token\" style=\"color:#393A34\">.</span>display <span class=\"token\" style=\"color:#0000ff\">import</span> display<span class=\"token\" style=\"color:#393A34\">,</span> Markdown\n<span class=\"token\" style=\"color:#0000ff\">from</span> gql <span class=\"token\" style=\"color:#0000ff\">import</span> gql<span class=\"token\" style=\"color:#393A34\">,</span> Client\n<span class=\"token\" style=\"color:#0000ff\">from</span> gql<span class=\"token\" style=\"color:#393A34\">.</span>transport<span class=\"token\" style=\"color:#393A34\">.</span>requests <span class=\"token\" style=\"color:#0000ff\">import</span> RequestsHTTPTransport\n\n_transport <span class=\"token\" style=\"color:#393A34\">=</span> RequestsHTTPTransport<span class=\"token\" style=\"color:#393A34\">(</span>\n    url<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;https://api.datacite.org/graphql&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    use_json<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\n\nclient <span class=\"token\" style=\"color:#393A34\">=</span> Client<span class=\"token\" style=\"color:#393A34\">(</span>\n    transport<span class=\"token\" style=\"color:#393A34\">=</span>_transport<span class=\"token\" style=\"color:#393A34\">,</span>\n    fetch_schema_from_transport<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>Define and run GraphQL query</h2>\n<p>Define the GraphQL query to find all publications including co-authors for <a>Dr Sarah Teichmann</a>:</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[231]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Generate the GraphQL query to retrieve up to 100 researchers matching query &quot;John and Smith&quot;</span>\nquery_params <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;query&quot;</span> <span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;John AND Smith&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;max_researchers&quot;</span> <span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#36acaa\">100</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;query_end_cursor&quot;</span> <span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span>\n<span class=\"token\" style=\"color:#393A34\">}</span>\n\nquery_str <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token,triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;query getResearchersByName(\n    $query: String!,\n    $max_researchers: Int!,\n    $query_end_cursor : String!\n    )\n{\n  people(query: $query, first: $max_researchers, after: $query_end_cursor) {\n    totalCount\n    pageInfo {\n      hasNextPage\n      endCursor\n    }  \n    nodes {\n      id\n      givenName\n      familyName\n      name\n      affiliation {\n        name\n      }\n    }\n  }\n}\n&quot;&quot;&quot;</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><p>Run the above query via the GraphQL client</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[232]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> json\nfound_next_page <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">True</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Initialise overall data dict that will store results</span>\ndata <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Keep retrieving results until there are no more results left</span>\n<span class=\"token\" style=\"color:#0000ff\">while</span> <span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    query <span class=\"token\" style=\"color:#393A34\">=</span> gql<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;%s&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> query_str<span class=\"token\" style=\"color:#393A34\">)</span>\n    res <span class=\"token\" style=\"color:#393A34\">=</span> client<span class=\"token\" style=\"color:#393A34\">.</span>execute<span class=\"token\" style=\"color:#393A34\">(</span>query<span class=\"token\" style=\"color:#393A34\">,</span> variable_values<span class=\"token\" style=\"color:#393A34\">=</span>json<span class=\"token\" style=\"color:#393A34\">.</span>dumps<span class=\"token\" style=\"color:#393A34\">(</span>query_params<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;people&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> data<span class=\"token\" style=\"color:#393A34\">:</span>\n        data <span class=\"token\" style=\"color:#393A34\">=</span> res\n    <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        people <span class=\"token\" style=\"color:#393A34\">=</span> res<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;people&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        data<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;people&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;nodes&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>extend<span class=\"token\" style=\"color:#393A34\">(</span>people<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;nodes&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        pageInfo <span class=\"token\" style=\"color:#393A34\">=</span> people<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;pageInfo&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> pageInfo<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;hasNextPage&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            <span class=\"token\" style=\"color:#0000ff\">if</span> pageInfo<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;endCursor&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#36acaa\">None</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                query_params<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;query_end_cursor&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> pageInfo<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;endCursor&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>            \n            <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                <span class=\"token\" style=\"color:#0000ff\">break</span>\n        <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            <span class=\"token\" style=\"color:#0000ff\">break</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h2>List researcher details</h2>\n<p>List in tabular format affilitions and the corresponding researcher names. This allows the user to select one of the affiliations to use in a more detailed query (see below) that also retrieves publications.</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[234]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Collect names and affiliations for the researchers found</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Test if fieldValue matches (case-insensitively) a Solr-style query (with &quot; AND &quot; representing the logical AND, and &quot; &quot; representing the logical OR)</span>\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">testIfPresentCaseInsensitive</span><span class=\"token\" style=\"color:#393A34\">(</span>solrQuery<span class=\"token\" style=\"color:#393A34\">,</span> fieldValueLowerCase<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> orTerms <span class=\"token\" style=\"color:#0000ff\">in</span> solrQuery<span class=\"token\" style=\"color:#393A34\">.</span>split<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot; AND &quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        present <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">False</span>\n        <span class=\"token\" style=\"color:#0000ff\">for</span> term <span class=\"token\" style=\"color:#0000ff\">in</span> orTerms<span class=\"token\" style=\"color:#393A34\">.</span>split<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            <span class=\"token\" style=\"color:#0000ff\">if</span> term<span class=\"token\" style=\"color:#393A34\">.</span>lower<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">in</span> fieldValueLowerCase<span class=\"token\" style=\"color:#393A34\">:</span>\n                present <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">True</span>\n                <span class=\"token\" style=\"color:#0000ff\">break</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#0000ff\">not</span> present<span class=\"token\" style=\"color:#393A34\">:</span>\n            <span class=\"token\" style=\"color:#0000ff\">return</span> <span class=\"token\" style=\"color:#36acaa\">False</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> <span class=\"token\" style=\"color:#36acaa\">True</span>\n\npeople <span class=\"token\" style=\"color:#393A34\">=</span> data<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;people&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\naf2Names <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\ntotalCount <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> node <span class=\"token\" style=\"color:#0000ff\">in</span> people<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;nodes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token,builtin\">id</span> <span class=\"token\" style=\"color:#393A34\">=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;id&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    name <span class=\"token\" style=\"color:#393A34\">=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;name&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#     TODO: Remove if we manage to search only individual fields</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#0000ff\">not</span> testIfPresentCaseInsensitive<span class=\"token\" style=\"color:#393A34\">(</span>query_params<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;query&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> name<span class=\"token\" style=\"color:#393A34\">.</span>lower<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">continue</span>\n    totalCount <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> af <span class=\"token\" style=\"color:#0000ff\">in</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;affiliation&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        affiliation <span class=\"token\" style=\"color:#393A34\">=</span> af<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;name&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> affiliation <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> af2Names<span class=\"token\" style=\"color:#393A34\">:</span>\n            af2Names<span class=\"token\" style=\"color:#393A34\">[</span>affiliation<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token,builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        af2Names<span class=\"token\" style=\"color:#393A34\">[</span>affiliation<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>add<span class=\"token\" style=\"color:#393A34\">(</span>name<span class=\"token\" style=\"color:#393A34\">)</span>\n\ntableBody <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> af<span class=\"token\" style=\"color:#393A34\">,</span>names <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token,builtin\">sorted</span><span class=\"token\" style=\"color:#393A34\">(</span>af2Names<span class=\"token\" style=\"color:#393A34\">.</span>items<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    tableBody <span class=\"token\" style=\"color:#393A34\">+=</span> af <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot; | &quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&#x27;, &#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>names<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot;\\n&quot;</span>\ndisplay<span class=\"token\" style=\"color:#393A34\">(</span>Markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;Total number of researchers found: **%d**&lt;br&gt;The list of researchers by affiliation is as follows:&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> totalCount<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay<span class=\"token\" style=\"color:#393A34\">(</span>Markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\ndisplay<span class=\"token\" style=\"color:#393A34\">(</span>Markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;| Affiliation | Researcher Names |\\n|---|---|\\n%s&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> tableBody<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-gzVnrw jFzGrB\"></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[235]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Generate the GraphQL query to retrieve all researchers matching query &quot;John and Smith&quot; and affiliation &quot;University of Arizona&quot;, now with works</span>\nname_query <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;John AND Smith&quot;</span>\naffiliation_query <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;\\&quot;University of Arizona\\&quot;&quot;</span>\nquery_params1 <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;query&quot;</span> <span class=\"token\" style=\"color:#393A34\">:</span> name_query <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot; AND &quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> affiliation_query<span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;max_researchers&quot;</span> <span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;query_end_cursor&quot;</span> <span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span>    \n<span class=\"token\" style=\"color:#393A34\">}</span>\n\nquery_str <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token,triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;query getResearchersByName(\n    $query: String!,\n    $max_researchers: Int!,\n    $query_end_cursor : String!\n    )\n{\n  people(query: $query, first: $max_researchers, after: $query_end_cursor) {\n    totalCount\n    pageInfo {\n      hasNextPage\n      endCursor\n    }      \n    nodes {\n      id\n      givenName\n      familyName\n      name\n      affiliation {\n        name\n      }\n      works(first: 3) {\n        nodes {\n          id\n          publicationYear\n          publisher\n          titles {\n            title\n          }\n          creators {\n            id\n            name\n            affiliation {\n              id\n              name\n            }\n          }\n          subjects {\n            subject\n          }\n        }\n      }\n    }\n  }\n}\n&quot;&quot;&quot;</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><p>Run the above query via the GraphQL client</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[236]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> json\nfound_next_page <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">True</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Initialise overall data dict that will store results</span>\ndata1 <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Keep retrieving results until there are no more results left</span>\n<span class=\"token\" style=\"color:#0000ff\">while</span> <span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    query <span class=\"token\" style=\"color:#393A34\">=</span> gql<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;%s&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> query_str<span class=\"token\" style=\"color:#393A34\">)</span>\n    res <span class=\"token\" style=\"color:#393A34\">=</span> client<span class=\"token\" style=\"color:#393A34\">.</span>execute<span class=\"token\" style=\"color:#393A34\">(</span>query<span class=\"token\" style=\"color:#393A34\">,</span> variable_values<span class=\"token\" style=\"color:#393A34\">=</span>json<span class=\"token\" style=\"color:#393A34\">.</span>dumps<span class=\"token\" style=\"color:#393A34\">(</span>query_params1<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;people&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> data1<span class=\"token\" style=\"color:#393A34\">:</span>\n        data1 <span class=\"token\" style=\"color:#393A34\">=</span> res\n    <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        people <span class=\"token\" style=\"color:#393A34\">=</span> res<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;people&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        data1<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;people&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;nodes&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>extend<span class=\"token\" style=\"color:#393A34\">(</span>people<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;nodes&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        pageInfo <span class=\"token\" style=\"color:#393A34\">=</span> people<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;pageInfo&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> pageInfo<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;hasNextPage&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            <span class=\"token\" style=\"color:#0000ff\">if</span> pageInfo<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;endCursor&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#36acaa\">None</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                query_params<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;query_end_cursor&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> pageInfo<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;endCursor&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>            \n            <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                <span class=\"token\" style=\"color:#0000ff\">break</span>\n        <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            <span class=\"token\" style=\"color:#0000ff\">break</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[237]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> textwrap <span class=\"token\" style=\"color:#0000ff\">import</span> shorten\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Collect all relevant details for the researchers found</span>\ntableBody<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token,builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\npeople <span class=\"token\" style=\"color:#393A34\">=</span> data1<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;people&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> node <span class=\"token\" style=\"color:#0000ff\">in</span> people<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;nodes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token,builtin\">id</span> <span class=\"token\" style=\"color:#393A34\">=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;id&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    firstName <span class=\"token\" style=\"color:#393A34\">=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;givenName&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    surname <span class=\"token\" style=\"color:#393A34\">=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;familyName&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    name <span class=\"token\" style=\"color:#393A34\">=</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;name&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#     TODO: Remove if we manage to search only individual fields</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#0000ff\">not</span> testIfPresentCaseInsensitive<span class=\"token\" style=\"color:#393A34\">(</span>name_query<span class=\"token\" style=\"color:#393A34\">,</span> name<span class=\"token\" style=\"color:#393A34\">.</span>lower<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">continue</span>    \n    orcidHref <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token,builtin\">id</span> <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#36acaa\">None</span> <span class=\"token\" style=\"color:#0000ff\">and</span> <span class=\"token,builtin\">id</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        orcidHref <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;[&quot;</span><span class=\"token\" style=\"color:#393A34\">+</span> name <span class=\"token\" style=\"color:#393A34\">+</span><span class=\"token\" style=\"color:#A31515\">&quot;](&quot;</span><span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token,builtin\">id</span> <span class=\"token\" style=\"color:#393A34\">+</span><span class=\"token\" style=\"color:#A31515\">&quot;)&quot;</span>    \n    affiliations <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> affiliation <span class=\"token\" style=\"color:#0000ff\">in</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;affiliation&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        affiliations<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>affiliation<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;name&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    works <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&#x27;works&#x27;</span> <span class=\"token\" style=\"color:#0000ff\">in</span> node<span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">for</span> work <span class=\"token\" style=\"color:#0000ff\">in</span> node<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;works&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;nodes&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            titles <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n            <span class=\"token\" style=\"color:#0000ff\">for</span> title <span class=\"token\" style=\"color:#0000ff\">in</span> work<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;titles&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                titles<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>shorten<span class=\"token\" style=\"color:#393A34\">(</span>title<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;title&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> width<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">50</span><span class=\"token\" style=\"color:#393A34\">,</span> placeholder<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;...&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n            creators <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n            cnt <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n            <span class=\"token\" style=\"color:#0000ff\">for</span> creator <span class=\"token\" style=\"color:#0000ff\">in</span> work<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;creators&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                cnt <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n                <span class=\"token\" style=\"color:#008000;font-style:italic\"># Restrict display to the first author only                 </span>\n                <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#393A34\">(</span>cnt <span class=\"token\" style=\"color:#393A34\">&gt;</span> <span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                    creators<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#A31515\">&quot; et al.&quot;</span>\n                    <span class=\"token\" style=\"color:#0000ff\">break</span>\n                <span class=\"token\" style=\"color:#0000ff\">if</span> creator<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;id&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#36acaa\">None</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                    creators<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;[&quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> creator<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;name&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot;](&quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> creator<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;id&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot;)&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n                <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                    creators<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>creator<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;name&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n            \n            works <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;; &#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>creators<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot; (&quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token,builtin\">str</span><span class=\"token\" style=\"color:#393A34\">(</span>work<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;publicationYear&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot;) [&quot;</span><span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&#x27;, &#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>titles<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">+</span><span class=\"token\" style=\"color:#A31515\">&quot;](&quot;</span><span class=\"token\" style=\"color:#393A34\">+</span> work<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;id&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot;) *&quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> work<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;publisher&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot;*&lt;br&gt;&quot;</span> \n        \n    tableBody<span class=\"token\" style=\"color:#393A34\">.</span>add<span class=\"token\" style=\"color:#393A34\">(</span>firstName <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot; | &quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> surname <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot; | &quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> orcidHref <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot; | &quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&#x27;&lt;br&gt;&#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token,builtin\">sorted</span><span class=\"token\" style=\"color:#393A34\">(</span>affiliations<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot; | &quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> works<span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay<span class=\"token\" style=\"color:#393A34\">(</span>Markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;| First Name | Surname | Link to ORCID | Affiliations | Works | \\n|---|---|---|---|---|\\n%s&quot;</span> <span class=\"token\" style=\"color:#393A34\">%</span> <span class=\"token\" style=\"color:#A31515\">&#x27;\\n&#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>tableBody<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-gzVnrw jFzGrB\"></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"></code></pre></div></div></div></div>","internal":{"content":"{\n \"cells\": [\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \" [FREYA](https://www.project-freya.eu/en) | WP2 [User Story 6](https://www.pidforum.org/t/pid-graph-graphql-example-disambiguate-researchers/931): As a researcher, I am looking for more information about another researcher with a common name, but donâ€™t know his/her ORCID ID.\\n\",\n    \":------------- | :------------- | :-------------\\n\",\n    \"\\n\",\n    \"It is important to be able to locate a researcher of interest even though their ORCID ID is unknown. For example, a reader of a scientific publication may wish to find out more about one of the authors, whereby the publisher has not cross-referenced that author's name to ORCID.<p />\\n\",\n    \"\\n\",\n    \"This notebook uses the [DataCite GraphQL API](https://api.datacite.org/graphql) to disambiguate a researcher name via a *funnel* approach:\\n\",\n    \" * First all researcher records matching query \\\"John AND Smith\\\" and retrieved, and an alphabetically sorted list of affiliations and the corresponding researcher names is displayed;\\n\",\n    \" * Then the notebook simulates the user selecting one of the affiliations (in our case \\\"University of Arizona\\\"), and then performs a more detailed query: \\\"John AND Smith AND University of Arizona\\\". The second query retrieves and displays a much smaller set of results, now also containing the researcher's publications, thus helping the user pinpoint the researcher of interest more easily.\\n\",\n    \"\\n\",\n    \"**Goal**: By the end of this notebook, you should be able successfully disambiguate a researcher name of interest.\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Install libraries and prepare GraphQL client\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 228,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"%%capture\\n\",\n    \"# Install required Python packages\\n\",\n    \"!pip install gql requests\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 229,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"# Prepare the GraphQL client\\n\",\n    \"import requests\\n\",\n    \"from IPython.display import display, Markdown\\n\",\n    \"from gql import gql, Client\\n\",\n    \"from gql.transport.requests import RequestsHTTPTransport\\n\",\n    \"\\n\",\n    \"_transport = RequestsHTTPTransport(\\n\",\n    \"    url='https://api.datacite.org/graphql',\\n\",\n    \"    use_json=True,\\n\",\n    \")\\n\",\n    \"\\n\",\n    \"client = Client(\\n\",\n    \"    transport=_transport,\\n\",\n    \"    fetch_schema_from_transport=True,\\n\",\n    \")\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## Define and run GraphQL query\\n\",\n    \"Define the GraphQL query to find all publications including co-authors for [Dr Sarah Teichmann](https://orcid.org/0000-0002-6294-6366):\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 231,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"# Generate the GraphQL query to retrieve up to 100 researchers matching query \\\"John and Smith\\\"\\n\",\n    \"query_params = {\\n\",\n    \"    \\\"query\\\" : \\\"John AND Smith\\\",\\n\",\n    \"    \\\"max_researchers\\\" : 100,\\n\",\n    \"    \\\"query_end_cursor\\\" : \\\"\\\"\\n\",\n    \"}\\n\",\n    \"\\n\",\n    \"query_str = \\\"\\\"\\\"query getResearchersByName(\\n\",\n    \"    $query: String!,\\n\",\n    \"    $max_researchers: Int!,\\n\",\n    \"    $query_end_cursor : String!\\n\",\n    \"    )\\n\",\n    \"{\\n\",\n    \"  people(query: $query, first: $max_researchers, after: $query_end_cursor) {\\n\",\n    \"    totalCount\\n\",\n    \"    pageInfo {\\n\",\n    \"      hasNextPage\\n\",\n    \"      endCursor\\n\",\n    \"    }  \\n\",\n    \"    nodes {\\n\",\n    \"      id\\n\",\n    \"      givenName\\n\",\n    \"      familyName\\n\",\n    \"      name\\n\",\n    \"      affiliation {\\n\",\n    \"        name\\n\",\n    \"      }\\n\",\n    \"    }\\n\",\n    \"  }\\n\",\n    \"}\\n\",\n    \"\\\"\\\"\\\"\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"Run the above query via the GraphQL client\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 232,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"import json\\n\",\n    \"found_next_page = True\\n\",\n    \"\\n\",\n    \"# Initialise overall data dict that will store results\\n\",\n    \"data = {}\\n\",\n    \"\\n\",\n    \"# Keep retrieving results until there are no more results left\\n\",\n    \"while True:\\n\",\n    \"    query = gql(\\\"%s\\\" % query_str)\\n\",\n    \"    res = client.execute(query, variable_values=json.dumps(query_params))\\n\",\n    \"    if \\\"people\\\" not in data:\\n\",\n    \"        data = res\\n\",\n    \"    else:\\n\",\n    \"        people = res[\\\"people\\\"]\\n\",\n    \"        data[\\\"people\\\"][\\\"nodes\\\"].extend(people[\\\"nodes\\\"])\\n\",\n    \"        pageInfo = people[\\\"pageInfo\\\"]\\n\",\n    \"        if pageInfo[\\\"hasNextPage\\\"]:\\n\",\n    \"            if pageInfo[\\\"endCursor\\\"] is not None:\\n\",\n    \"                query_params[\\\"query_end_cursor\\\"] = pageInfo[\\\"endCursor\\\"]            \\n\",\n    \"            else:\\n\",\n    \"                break\\n\",\n    \"        else:\\n\",\n    \"            break\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"## List researcher details\\n\",\n    \"List in tabular format affilitions and the corresponding researcher names. This allows the user to select one of the affiliations to use in a more detailed query (see below) that also retrieves publications.\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 234,\n   \"metadata\": {},\n   \"outputs\": [\n    {\n     \"data\": {\n      \"text/markdown\": [\n       \"Total number of researchers found: **210**<br>The list of researchers by affiliation is as follows:\"\n      ],\n      \"text/plain\": [\n       \"<IPython.core.display.Markdown object>\"\n      ]\n     },\n     \"metadata\": {},\n     \"output_type\": \"display_data\"\n    },\n    {\n     \"data\": {\n      \"text/markdown\": [],\n      \"text/plain\": [\n       \"<IPython.core.display.Markdown object>\"\n      ]\n     },\n     \"metadata\": {},\n     \"output_type\": \"display_data\"\n    },\n    {\n     \"data\": {\n      \"text/markdown\": [\n       \"| Affiliation | Researcher Names |\\n\",\n       \"|---|---|\\n\",\n       \"American Chemical Society | John Smith\\n\",\n       \"American Science and Engineering, Inc. | Henry John Peter Smith\\n\",\n       \"Bank Street College of Education | John Smith\\n\",\n       \"Bedford Institute of Oceanography | John Smith\\n\",\n       \"Beecham Pharmaceuticals | John Smith\\n\",\n       \"Birkenhead High School Academy | John Arthur Smith\\n\",\n       \"Bureau of Ocean Energy Management, Pacific OCS Region | John Smith\\n\",\n       \"CU Sports Medicine and Performance | John-Rudolph Smith\\n\",\n       \"Charles Sturt University - Wagga Wagga Campus | John Smith\\n\",\n       \"Church of Norway | John Arthur Smith\\n\",\n       \"City College of New York | John Smith Del Rosario\\n\",\n       \"Colorado School of Mines | John Smith\\n\",\n       \"Cornell University | John-David Smith\\n\",\n       \"CottonInfo | John Smith\\n\",\n       \"Drew University | John Smith\\n\",\n       \"East Carolina University | John Smith\\n\",\n       \"Fairleigh Dickinson University | John Smith\\n\",\n       \"Federation of Liberian Youth - FLY | John Solunta Smith Jr\\n\",\n       \"Fire Risk Assessment Network | John Smith\\n\",\n       \"Flagburn Health Center | John Smith\\n\",\n       \"Fluent Technology | John Smith\\n\",\n       \"George Washington University | John Smith\\n\",\n       \"Georgia State University | John Smith\\n\",\n       \"GlaxoSmithKline Plc | John Smith\\n\",\n       \"Lipscomb University | John Smith\\n\",\n       \"London University | John Smith\\n\",\n       \"Louisiana State University | John F. Smith\\n\",\n       \"MSG Software (USA), Inc. | Henry John Peter Smith\\n\",\n       \"Manhattan College | Henry John Peter Smith\\n\",\n       \"Michigan State University | John Smith\\n\",\n       \"Millersville University | John Smith\\n\",\n       \"NASA Langley Research Center | John Smith\\n\",\n       \"New South Wales Department of Primary Industries Agriculture | John Smith\\n\",\n       \"Northeastern University | Henry John Peter Smith\\n\",\n       \"Northwestern University | John F. Smith\\n\",\n       \"Nova Scotia Health Authority South Western Nova Scotia | John Smith\\n\",\n       \"OCS Energy Consultant | John Smith\\n\",\n       \"Ohio State University | John R. Smith\\n\",\n       \"Oxford University Press | John Arthur Smith\\n\",\n       \"Peking University | John Solunta Smith Jr\\n\",\n       \"Pennsylvania State University | John Smith\\n\",\n       \"Proof Read My File | John Smith\\n\",\n       \"RMIT University City Campus | John Smith\\n\",\n       \"Retired | John Arthur Smith\\n\",\n       \"Rutgers New Jersey Medical School | John Smith Del Rosario\\n\",\n       \"Rutgers University Camden | John Smith\\n\",\n       \"Sample invited position | John Smith\\n\",\n       \"Sigma Xi the Scientific Research Society | John Smith\\n\",\n       \"TPE Associates Inc | Henry John Peter Smith\\n\",\n       \"Technical Support | John Smith\\n\",\n       \"Tennessee Technological University | John Smith\\n\",\n       \"The New School for Social Research | John Smith\\n\",\n       \"The University of St Andrews | Christopher John Smith\\n\",\n       \"Tufts University | Henry John Peter Smith\\n\",\n       \"Ulster Univeristy | John Smith\\n\",\n       \"Ulster University | John Smith\\n\",\n       \"University College London | John Smith\\n\",\n       \"University at Buffalo | John Smith\\n\",\n       \"University of Arizona | Smith, John E. 3rd\\n\",\n       \"University of California Davis | John R Smith\\n\",\n       \"University of Cambridge | John Arthur Smith\\n\",\n       \"University of Central Missouri | John Smith\\n\",\n       \"University of Colorado | John Smith\\n\",\n       \"University of Colorado Boulder | JOHN SMITH, John Smith\\n\",\n       \"University of Liverpool | John Arthur Smith, Quintin-John Smith\\n\",\n       \"University of Michigan | John R. Smith\\n\",\n       \"University of Missouri Columbia | John Smith\\n\",\n       \"University of Ottawa | John Smith\\n\",\n       \"University of Oxford | Christopher John Smith\\n\",\n       \"University of Pennsylvania | John F. Smith, John Smith\\n\",\n       \"University of St Andrews | Christopher John Smith\\n\",\n       \"University of Strathclyde | John Smith\\n\",\n       \"University of Toledo | John-David Smith\\n\",\n       \"University of Toronto | John Smith\\n\",\n       \"University of Virginia | Smith, John E. 3rd\\n\",\n       \"University of York | John Smith\\n\",\n       \"Vanderbilt University | John Smith\\n\",\n       \"Virginia Commonwealth University | John Lee Smith\\n\",\n       \"Visidyne, Inc. | Henry John Peter Smith\\n\",\n       \"Yale University | John Smith\\n\"\n      ],\n      \"text/plain\": [\n       \"<IPython.core.display.Markdown object>\"\n      ]\n     },\n     \"metadata\": {},\n     \"output_type\": \"display_data\"\n    }\n   ],\n   \"source\": [\n    \"# Collect names and affiliations for the researchers found\\n\",\n    \"# Test if fieldValue matches (case-insensitively) a Solr-style query (with \\\" AND \\\" representing the logical AND, and \\\" \\\" representing the logical OR)\\n\",\n    \"def testIfPresentCaseInsensitive(solrQuery, fieldValueLowerCase):\\n\",\n    \"    for orTerms in solrQuery.split(\\\" AND \\\"):\\n\",\n    \"        present = False\\n\",\n    \"        for term in orTerms.split(\\\" \\\"):\\n\",\n    \"            if term.lower() in fieldValueLowerCase:\\n\",\n    \"                present = True\\n\",\n    \"                break\\n\",\n    \"        if not present:\\n\",\n    \"            return False\\n\",\n    \"    return True\\n\",\n    \"\\n\",\n    \"people = data['people']\\n\",\n    \"af2Names = {}\\n\",\n    \"totalCount = 0\\n\",\n    \"for node in people['nodes']:\\n\",\n    \"    id = node['id']\\n\",\n    \"    name = node['name']\\n\",\n    \"#     TODO: Remove if we manage to search only individual fields\\n\",\n    \"    if not testIfPresentCaseInsensitive(query_params['query'], name.lower()):\\n\",\n    \"        continue\\n\",\n    \"    totalCount += 1\\n\",\n    \"    for af in node['affiliation']:\\n\",\n    \"        affiliation = af['name']\\n\",\n    \"        if affiliation not in af2Names:\\n\",\n    \"            af2Names[affiliation] = set()\\n\",\n    \"        af2Names[affiliation].add(name)\\n\",\n    \"\\n\",\n    \"tableBody = \\\"\\\"\\n\",\n    \"for af,names in sorted(af2Names.items()):\\n\",\n    \"    tableBody += af + \\\" | \\\" + ', '.join(names) + \\\"\\\\n\\\"\\n\",\n    \"display(Markdown(\\\"Total number of researchers found: **%d**<br>The list of researchers by affiliation is as follows:\\\" % totalCount))\\n\",\n    \"display(Markdown(\\\"\\\"))\\n\",\n    \"\\n\",\n    \"display(Markdown(\\\"| Affiliation | Researcher Names |\\\\n|---|---|\\\\n%s\\\" % tableBody))\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 235,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"# Generate the GraphQL query to retrieve all researchers matching query \\\"John and Smith\\\" and affiliation \\\"University of Arizona\\\", now with works\\n\",\n    \"name_query = \\\"John AND Smith\\\"\\n\",\n    \"affiliation_query = \\\"\\\\\\\"University of Arizona\\\\\\\"\\\"\\n\",\n    \"query_params1 = {\\n\",\n    \"    \\\"query\\\" : name_query + \\\" AND \\\" + affiliation_query,\\n\",\n    \"    \\\"max_researchers\\\" : 10,\\n\",\n    \"    \\\"query_end_cursor\\\" : \\\"\\\"    \\n\",\n    \"}\\n\",\n    \"\\n\",\n    \"query_str = \\\"\\\"\\\"query getResearchersByName(\\n\",\n    \"    $query: String!,\\n\",\n    \"    $max_researchers: Int!,\\n\",\n    \"    $query_end_cursor : String!\\n\",\n    \"    )\\n\",\n    \"{\\n\",\n    \"  people(query: $query, first: $max_researchers, after: $query_end_cursor) {\\n\",\n    \"    totalCount\\n\",\n    \"    pageInfo {\\n\",\n    \"      hasNextPage\\n\",\n    \"      endCursor\\n\",\n    \"    }      \\n\",\n    \"    nodes {\\n\",\n    \"      id\\n\",\n    \"      givenName\\n\",\n    \"      familyName\\n\",\n    \"      name\\n\",\n    \"      affiliation {\\n\",\n    \"        name\\n\",\n    \"      }\\n\",\n    \"      works(first: 3) {\\n\",\n    \"        nodes {\\n\",\n    \"          id\\n\",\n    \"          publicationYear\\n\",\n    \"          publisher\\n\",\n    \"          titles {\\n\",\n    \"            title\\n\",\n    \"          }\\n\",\n    \"          creators {\\n\",\n    \"            id\\n\",\n    \"            name\\n\",\n    \"            affiliation {\\n\",\n    \"              id\\n\",\n    \"              name\\n\",\n    \"            }\\n\",\n    \"          }\\n\",\n    \"          subjects {\\n\",\n    \"            subject\\n\",\n    \"          }\\n\",\n    \"        }\\n\",\n    \"      }\\n\",\n    \"    }\\n\",\n    \"  }\\n\",\n    \"}\\n\",\n    \"\\\"\\\"\\\"\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"Run the above query via the GraphQL client\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 236,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"import json\\n\",\n    \"found_next_page = True\\n\",\n    \"\\n\",\n    \"# Initialise overall data dict that will store results\\n\",\n    \"data1 = {}\\n\",\n    \"\\n\",\n    \"# Keep retrieving results until there are no more results left\\n\",\n    \"while True:\\n\",\n    \"    query = gql(\\\"%s\\\" % query_str)\\n\",\n    \"    res = client.execute(query, variable_values=json.dumps(query_params1))\\n\",\n    \"    if \\\"people\\\" not in data1:\\n\",\n    \"        data1 = res\\n\",\n    \"    else:\\n\",\n    \"        people = res[\\\"people\\\"]\\n\",\n    \"        data1[\\\"people\\\"][\\\"nodes\\\"].extend(people[\\\"nodes\\\"])\\n\",\n    \"        pageInfo = people[\\\"pageInfo\\\"]\\n\",\n    \"        if pageInfo[\\\"hasNextPage\\\"]:\\n\",\n    \"            if pageInfo[\\\"endCursor\\\"] is not None:\\n\",\n    \"                query_params[\\\"query_end_cursor\\\"] = pageInfo[\\\"endCursor\\\"]            \\n\",\n    \"            else:\\n\",\n    \"                break\\n\",\n    \"        else:\\n\",\n    \"            break\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": 237,\n   \"metadata\": {},\n   \"outputs\": [\n    {\n     \"data\": {\n      \"text/markdown\": [\n       \"| First Name | Surname | Link to ORCID | Affiliations | Works | \\n\",\n       \"|---|---|---|---|---|\\n\",\n       \"John E | Smith | [Smith, John E. 3rd](https://orcid.org/0000-0002-0888-1274) | University of Arizona<br>University of Virginia | [Smith, John Edward](https://orcid.org/0000-0002-0888-1274) (2020) [CS_216516.sf3](https://doi.org/10.7910/dvn/ozqd7g/1a1qty) *Harvard Dataverse*<br>[Smith, John Edward](https://orcid.org/0000-0002-0888-1274) (2020) [human N2Aus PKA phosphorylation](https://doi.org/10.7910/dvn/ozqd7g) *Harvard Dataverse*<br>[Lostal, William](https://orcid.org/0000-0003-1014-1950) et al. (2019) [Titin splicing regulates cardiotoxicity...](https://doi.org/10.1126/scitranslmed.aat6072) *American Association for the Advancement of Science (AAAS)*<br>\"\n      ],\n      \"text/plain\": [\n       \"<IPython.core.display.Markdown object>\"\n      ]\n     },\n     \"metadata\": {},\n     \"output_type\": \"display_data\"\n    }\n   ],\n   \"source\": [\n    \"from textwrap import shorten\\n\",\n    \"\\n\",\n    \"# Collect all relevant details for the researchers found\\n\",\n    \"tableBody=set()\\n\",\n    \"people = data1['people']\\n\",\n    \"for node in people['nodes']:\\n\",\n    \"    id = node['id']\\n\",\n    \"    firstName = node['givenName']\\n\",\n    \"    surname = node['familyName']\\n\",\n    \"    name = node['name']\\n\",\n    \"#     TODO: Remove if we manage to search only individual fields\\n\",\n    \"    if not testIfPresentCaseInsensitive(name_query, name.lower()):\\n\",\n    \"        continue    \\n\",\n    \"    orcidHref = \\\"\\\"\\n\",\n    \"    if id is not None and id != \\\"\\\":\\n\",\n    \"        orcidHref = \\\"[\\\"+ name +\\\"](\\\"+ id +\\\")\\\"    \\n\",\n    \"    affiliations = []\\n\",\n    \"    for affiliation in node['affiliation']:\\n\",\n    \"        affiliations.append(affiliation['name'])\\n\",\n    \"    works = \\\"\\\"\\n\",\n    \"    if 'works' in node:\\n\",\n    \"        for work in node['works']['nodes']:\\n\",\n    \"            titles = []\\n\",\n    \"            for title in work['titles']:\\n\",\n    \"                titles.append(shorten(title['title'], width=50, placeholder=\\\"...\\\"))\\n\",\n    \"            creators = []\\n\",\n    \"            cnt = 0\\n\",\n    \"            for creator in work['creators']:\\n\",\n    \"                cnt += 1\\n\",\n    \"                # Restrict display to the first author only                 \\n\",\n    \"                if (cnt > 1):\\n\",\n    \"                    creators[-1] += \\\" et al.\\\"\\n\",\n    \"                    break\\n\",\n    \"                if creator['id'] is not None:\\n\",\n    \"                    creators.append(\\\"[\\\" + creator['name'] + \\\"](\\\" + creator['id'] + \\\")\\\")\\n\",\n    \"                else:\\n\",\n    \"                    creators.append(creator['name'])\\n\",\n    \"            \\n\",\n    \"            works += '; '.join(creators) + \\\" (\\\" + str(work['publicationYear']) + \\\") [\\\"+ ', '.join(titles) +\\\"](\\\"+ work['id'] + \\\") *\\\" + work['publisher'] + \\\"*<br>\\\" \\n\",\n    \"        \\n\",\n    \"    tableBody.add(firstName + \\\" | \\\" + surname + \\\" | \\\" + orcidHref + \\\" | \\\" + '<br>'.join(sorted(affiliations)) + \\\" | \\\" + works)\\n\",\n    \"display(Markdown(\\\"| First Name | Surname | Link to ORCID | Affiliations | Works | \\\\n|---|---|---|---|---|\\\\n%s\\\" % '\\\\n'.join(tableBody)))\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": []\n  }\n ],\n \"metadata\": {\n  \"kernelspec\": {\n   \"display_name\": \"Python 3\",\n   \"language\": \"python\",\n   \"name\": \"python3\"\n  },\n  \"language_info\": {\n   \"codemirror_mode\": {\n    \"name\": \"ipython\",\n    \"version\": 3\n   },\n   \"file_extension\": \".py\",\n   \"mimetype\": \"text/x-python\",\n   \"name\": \"python\",\n   \"nbconvert_exporter\": \"python\",\n   \"pygments_lexer\": \"ipython3\",\n   \"version\": \"3.6.1\"\n  }\n },\n \"nbformat\": 4,\n \"nbformat_minor\": 4\n}\n"},"fields":{"codemeta":{"identifier":"10.14454/03vp-ry06","codeRepository":"https://github.com/datacite/pidgraph-notebooks-python/tree/master/user-story-6-disambiguate-researchers","controlledTem":"software","datePublished":"2020-06-27","dateModified":"2020-06-27","dateCreated":"2020-06-27","description":"Jupyter notebook that uses GraphQL to implement EC-funded FREYA Project User Story 6: As a researcher, I am looking for more information about another researcher with a common name, but donâ€™t know his/her ORCID ID.","isAutomatedBuild":true,"issueTracker":"https://github.com/datacite/pidgraph-notebooks-python/issues","licenseId":"MIT","publisher":"DataCite","name":"FREYA PID Graph - Disambiguate researchers","version":"1.1.1"}}}},"pageContext":{"slug":"/pidgraph-notebooks-python/user-story-6-disambiguate-researchers/py-disambiguate-researchers-with-output/"}}}