{"componentChunkName":"component---src-templates-notebook-js","path":"/notebooks/pid-graph/r-organization-publications/r-organization-publications/","result":{"data":{"jupyterNotebook":{"html":"<div class=\"notebook-render\"><div class=\"sc-iwsKbI Dticx\"><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h1>PID Graph for publications from organization DataCite</h1>\n<p>This notebook uses the <a>DataCite GraphQL API</a> to fetch all publications whose metadata includes a DataCite ROR affiliation identifier.</p>\n<p>This notebook uses R, but you could do the same thing in another language of your choice. </p>\n<p>It might be also be helpful to consult the <a>DataCite metadata schema</a> for descriptions of resource types and other available fields. </p>\n<h1>Step 1: Prepare the R GraphQL client</h1>\n<p>Load necessary libraries and set up the DataCite GraphQL API endpoint. </p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[4]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Prepare the R graphql client.</span>\n\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;httr&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;ghql&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;jsonlite&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;IRdisplay&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;dplyr&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;igraph&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\ncli <span class=\"token\" style=\"color:#393A34\">&lt;-</span> GraphqlClient<span class=\"token\" style=\"color:#393A34\">$</span>new<span class=\"token\" style=\"color:#393A34\">(</span>\n  url <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;https://api.datacite.org/client-api/graphql&quot;</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\nqry <span class=\"token\" style=\"color:#393A34\">&lt;-</span> Query<span class=\"token\" style=\"color:#393A34\">$</span>new<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h1>Step 2: Generate the GraphQL query</h1>\n<p>In this query, we are looking through DataCite DOIs and finding those that include DataCite&#x27;s own organizational ROR ID as an affiliation identifier. </p>\n<p>DataCite DOIs can be assigned to datasets, publications, software and more. In this example we&#x27;ll just be looking through DataCite DOIs that are assigned to datasets and publications, but the DataCite GraphQL API lets you specify what you want to search through and how we want to get information back. </p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[5]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">query <span class=\"token\" style=\"color:#393A34\">&lt;-</span> &#x27;<span class=\"token\" style=\"color:#393A34\">{</span>\n  organization<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;https://ror.org/04wxnsj81&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n    publications<span class=\"token\" style=\"color:#393A34\">(</span>first<span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#36acaa\">150</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n      totalCount\n      nodes <span class=\"token\" style=\"color:#393A34\">{</span>\n        id\n        creators <span class=\"token\" style=\"color:#393A34\">{</span>\n          id\n          affiliation <span class=\"token\" style=\"color:#393A34\">{</span>\n            id\n          <span class=\"token\" style=\"color:#393A34\">}</span>\n        <span class=\"token\" style=\"color:#393A34\">}</span>\n        relatedIdentifiers <span class=\"token\" style=\"color:#393A34\">{</span>\n          relatedIdentifier\n        <span class=\"token\" style=\"color:#393A34\">}</span>\n        fundingReferences <span class=\"token\" style=\"color:#393A34\">{</span>\n          funderIdentifier\n        <span class=\"token\" style=\"color:#393A34\">}</span>\n      <span class=\"token\" style=\"color:#393A34\">}</span>\n    <span class=\"token\" style=\"color:#393A34\">}</span>\n    datasets <span class=\"token\" style=\"color:#393A34\">{</span>\n      totalCount\n      nodes <span class=\"token\" style=\"color:#393A34\">{</span>\n        id\n        creators <span class=\"token\" style=\"color:#393A34\">{</span>\n          id\n          affiliation <span class=\"token\" style=\"color:#393A34\">{</span>\n            id\n          <span class=\"token\" style=\"color:#393A34\">}</span>\n        <span class=\"token\" style=\"color:#393A34\">}</span>\n        relatedIdentifiers <span class=\"token\" style=\"color:#393A34\">{</span>\n          relatedIdentifier\n        <span class=\"token\" style=\"color:#393A34\">}</span>\n        fundingReferences <span class=\"token\" style=\"color:#393A34\">{</span>\n          funderIdentifier\n        <span class=\"token\" style=\"color:#393A34\">}</span>\n      <span class=\"token\" style=\"color:#393A34\">}</span>\n    <span class=\"token\" style=\"color:#393A34\">}</span>\n  <span class=\"token\" style=\"color:#393A34\">}</span>\n<span class=\"token\" style=\"color:#393A34\">}</span>&#x27;</code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h1>Step 3: Run the query</h1></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[6]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Run the query and parse the JSON response</span>\n\nqry<span class=\"token\" style=\"color:#393A34\">$</span>query<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;getdata&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> query<span class=\"token\" style=\"color:#393A34\">)</span>\ndata <span class=\"token\" style=\"color:#393A34\">&lt;-</span> fromJSON<span class=\"token\" style=\"color:#393A34\">(</span>cli<span class=\"token\" style=\"color:#393A34\">$</span>exec<span class=\"token\" style=\"color:#393A34\">(</span>qry<span class=\"token\" style=\"color:#393A34\">$</span>queries<span class=\"token\" style=\"color:#393A34\">$</span>getdata<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[7]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Get the number of publications and datasets</span>\n\ndisplay_json<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>organization<span class=\"token\" style=\"color:#393A34\">$</span>publications<span class=\"token\" style=\"color:#393A34\">$</span>totalCount<span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay_json<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>organization<span class=\"token\" style=\"color:#393A34\">$</span>datasets<span class=\"token\" style=\"color:#393A34\">$</span>totalCount<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-gzVnrw jFzGrB\"></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h1>Step 4: Make the graph</h1>\n<p>First we need to prepare the data frame and define all of the nodes for the graph. </p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># generate data frame for nodes</span>\npublications <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">=</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>organization<span class=\"token\" style=\"color:#393A34\">$</span>publications<span class=\"token\" style=\"color:#393A34\">$</span>nodes<span class=\"token\" style=\"color:#393A34\">$</span>id<span class=\"token\" style=\"color:#393A34\">,</span> pid_type<span class=\"token\" style=\"color:#393A34\">=</span>c<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;publication&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># datasets &lt;- data.frame(id=data$data$organization$datasets$nodes$id, pid_type=c(&#x27;dataset&#x27;))</span>\nresearchers <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">=</span>bind_rows<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>organization<span class=\"token\" style=\"color:#393A34\">$</span>publications<span class=\"token\" style=\"color:#393A34\">$</span>nodes<span class=\"token\" style=\"color:#393A34\">$</span>creators<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> pid_type<span class=\"token\" style=\"color:#393A34\">=</span>c<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;researcher&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nresearchers <span class=\"token\" style=\"color:#393A34\">&lt;-</span> researchers <span class=\"token,percent-operator\" style=\"color:#393A34\">%&gt;%</span> filter<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">!</span>is.na<span class=\"token\" style=\"color:#393A34\">(</span>as.character<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># dataset_researchers &lt;- data.frame(id=bind_rows(data$data$organization$datasets$nodes$creators)[,1], pid_type=c(&#x27;researcher&#x27;))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># dataset_researchers &lt;- dataset_researchers %&gt;% filter(!is.na(as.character(id)))</span>\norganizations <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">=</span>bind_rows<span class=\"token\" style=\"color:#393A34\">(</span>bind_rows<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>organization<span class=\"token\" style=\"color:#393A34\">$</span>publications<span class=\"token\" style=\"color:#393A34\">$</span>nodes<span class=\"token\" style=\"color:#393A34\">$</span>creators<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> pid_type<span class=\"token\" style=\"color:#393A34\">=</span>c<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;organization&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\norganizations <span class=\"token\" style=\"color:#393A34\">&lt;-</span> organizations <span class=\"token,percent-operator\" style=\"color:#393A34\">%&gt;%</span> filter<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">!</span>is.na<span class=\"token\" style=\"color:#393A34\">(</span>as.character<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#references &lt;- data.frame(id=bind_rows(data$data$organization$publications$nodes$relatedIdentifiers)[,1], pid_type=c(&#x27;publication&#x27;))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#references &lt;- references %&gt;% filter(!is.na(as.character(id))) %&gt;% mutate(id = ifelse(startsWith(as.character(id), &#x27;10.&#x27;), paste(&#x27;https://doi.org/&#x27;, id, sep=&#x27;&#x27;), as.character(id)))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># dataset_references &lt;- data.frame(id=bind_rows(data$data$organization$datasets$nodes$relatedIdentifiers)[,1], pid_type=c(&#x27;publication&#x27;))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#dataset_references &lt;- dataset_references %&gt;% filter(!is.na(as.character(id))) %&gt;% mutate(id = ifelse(startsWith(as.character(id), &#x27;10.&#x27;), paste(&#x27;https://doi.org/&#x27;, id, sep=&#x27;&#x27;), as.character(id)))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#funders &lt;- data.frame(id=bind_rows(data$data$organization$publications$nodes$fundingReferences)[,1], pid_type=c(&#x27;funder&#x27;))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#dataset_funders &lt;- data.frame(id=bind_rows(data$data$organization$datasets$nodes$fundingReferences)[,1], pid_type=c(&#x27;funder&#x27;))</span>\nnodes <span class=\"token\" style=\"color:#393A34\">&lt;-</span> rbind<span class=\"token\" style=\"color:#393A34\">(</span>publications<span class=\"token\" style=\"color:#393A34\">,</span> researchers<span class=\"token\" style=\"color:#393A34\">,</span> organizations<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># remove duplicates</span>\nnodes <span class=\"token\" style=\"color:#393A34\">&lt;-</span> nodes <span class=\"token,percent-operator\" style=\"color:#393A34\">%&gt;%</span> distinct<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">,</span> .keep_all <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">TRUE</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><p>Then we define the edges, looping through each node as we go.</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># loop through nodes, as they can have more than one edge</span>\nedges <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">=</span>character<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> from<span class=\"token\" style=\"color:#393A34\">=</span>character<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nnodes_with_creators <span class=\"token\" style=\"color:#393A34\">&lt;-</span> bind_rows<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>organization<span class=\"token\" style=\"color:#393A34\">$</span>publications<span class=\"token\" style=\"color:#393A34\">$</span>nodes<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token,percent-operator\" style=\"color:#393A34\">%&gt;%</span> filter<span class=\"token\" style=\"color:#393A34\">(</span>lengths<span class=\"token\" style=\"color:#393A34\">(</span>creators<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> <span class=\"token\" style=\"color:#393A34\">(</span>i <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">:</span>nrow<span class=\"token\" style=\"color:#393A34\">(</span>nodes_with_creators<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n  row <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">=</span>unlist<span class=\"token\" style=\"color:#393A34\">(</span>nodes_with_creators<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> from<span class=\"token\" style=\"color:#393A34\">=</span>nodes_with_creators<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n  edges <span class=\"token\" style=\"color:#393A34\">&lt;-</span> unique<span class=\"token\" style=\"color:#393A34\">(</span>rbind<span class=\"token\" style=\"color:#393A34\">(</span>edges<span class=\"token\" style=\"color:#393A34\">,</span> row<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#393A34\">}</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#dataset_nodes_with_creators &lt;- bind_rows(data$data$organization$datasets$nodes) %&gt;% filter(lengths(creators) != 0)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#for (i in 1:nrow(dataset_nodes_with_creators)) {</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  row &lt;- data.frame(to=unlist(dataset_nodes_with_creators[i,2]), from=dataset_nodes_with_creators[i,1])</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  edges &lt;- unique(rbind(edges, row))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#}</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#nodes_with_references &lt;- bind_rows(data$data$organization$publications$nodes) %&gt;% filter(lengths(relatedIdentifiers) != 0)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#for (i in 1:nrow(nodes_with_references)) {</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  row &lt;- data.frame(to=unlist(nodes_with_references[i,3]), from=nodes_with_references[i,1])</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  edges &lt;- unique(rbind(edges, row))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#}</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#dataset_nodes_with_references &lt;- bind_rows(data$data$organization$datasets$nodes) %&gt;% filter(lengths(relatedIdentifiers) != 0)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#for (i in 1:nrow(dataset_nodes_with_references)) {</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  row &lt;- data.frame(to=unlist(dataset_nodes_with_references[i,3]), from=dataset_nodes_with_references[i,1])</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  edges &lt;- unique(rbind(edges, row))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#}</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#nodes_with_dataset_references &lt;- bind_rows(data$data$organization$datasets$nodes) %&gt;% filter(lengths(relatedIdentifiers) != 0)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#for (i in 1:nrow(nodes_with_dataset_references)) {</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  row &lt;- data.frame(to=unlist(nodes_with_dataset_references[i,3]), from=nodes_with_dataset_references[i,1])</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  edges &lt;- unique(rbind(edges, row))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#}</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#nodes_with_funding &lt;- bind_rows(data$data$organization$publications$nodes) %&gt;% filter(lengths(fundingReferences) != 0)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#for (i in 1:nrow(nodes_with_funding)) {</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  row &lt;- data.frame(to=unlist(nodes_with_funding[i,4]), from=nodes_with_funding[i,1])</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  edges &lt;- unique(rbind(edges, row))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#}</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#dataset_nodes_with_funding &lt;- bind_rows(data$data$organization$datasets$nodes) %&gt;% filter(lengths(fundingReferences) != 0)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#for (i in 1:nrow(dataset_nodes_with_funding)) {</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  row &lt;- data.frame(to=unlist(dataset_nodes_with_funding[i,4]), from=dataset_nodes_with_funding[i,1])</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#  edges &lt;- unique(rbind(edges, row))</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#}</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># express DOIs as URLs</span>\nedges <span class=\"token\" style=\"color:#393A34\">&lt;-</span> edges <span class=\"token,percent-operator\" style=\"color:#393A34\">%&gt;%</span> filter<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">!</span>is.na<span class=\"token\" style=\"color:#393A34\">(</span>as.character<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token,percent-operator\" style=\"color:#393A34\">%&gt;%</span> mutate<span class=\"token\" style=\"color:#393A34\">(</span>to <span class=\"token\" style=\"color:#393A34\">=</span> ifelse<span class=\"token\" style=\"color:#393A34\">(</span>startsWith<span class=\"token\" style=\"color:#393A34\">(</span>as.character<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;10.&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> paste<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;https://doi.org/&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> to<span class=\"token\" style=\"color:#393A34\">,</span> sep<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> as.character<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><p>Next we format the graph for display, specifying color, node size, and other choices.</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">g <span class=\"token\" style=\"color:#393A34\">&lt;-</span> graph_from_data_frame<span class=\"token\" style=\"color:#393A34\">(</span>d<span class=\"token\" style=\"color:#393A34\">=</span>edges<span class=\"token\" style=\"color:#393A34\">,</span> vertices<span class=\"token\" style=\"color:#393A34\">=</span>nodes<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># add node colors</span>\ncols <span class=\"token\" style=\"color:#393A34\">&lt;-</span> brewer.pal<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">12</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;Set3&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay.brewer.pal<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">12</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;Set3&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ncol <span class=\"token\" style=\"color:#393A34\">=</span> c<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;#ccff66&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#A31515\">&#x27;#48b1f4&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#A31515\">&#x27;#53c48c&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nV<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>V<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">$</span>pid_type<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#A31515\">&quot;publication&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">$</span>color<span class=\"token\" style=\"color:#393A34\">&lt;-</span><span class=\"token\" style=\"color:#A31515\">&#x27;#48b1f4&#x27;</span>\nV<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>V<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">$</span>pid_type<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#A31515\">&quot;researcher&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">$</span>color<span class=\"token\" style=\"color:#393A34\">&lt;-</span><span class=\"token\" style=\"color:#A31515\">&#x27;#53c48c&#x27;</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#V(g)[(V(g)$pid_type==&quot;funder&quot;)]$color&lt;-&#x27;#fecf59&#x27;</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#V(g)[(V(g)$pid_type==&quot;dataset&quot;)]$color&lt;-&#x27;#e45718&#x27;</span>\nV<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span>V<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">$</span>pid_type<span class=\"token\" style=\"color:#393A34\">==</span><span class=\"token\" style=\"color:#A31515\">&quot;organization&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">$</span>color<span class=\"token\" style=\"color:#393A34\">&lt;-</span><span class=\"token\" style=\"color:#A31515\">&#x27;#ccff66&#x27;</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># add labels to selected nodes</span>\nV<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">$</span>label<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#0000ff\">NA</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#V(g)[(V(g)$id==&quot;https://doi.org/10.5281/zenodo.1202173&quot;)]$label&lt;-&quot;B&quot;</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#V(g)[(V(g)$pid_type==&quot;funder&quot;)]$label &lt;- &quot;A&quot;</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#V(g)[(V(g)$pid_type==&quot;funder&quot;)]$label.dist &lt;- 1</span>\n\nV<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">$</span>size <span class=\"token\" style=\"color:#393A34\">&lt;-</span> <span class=\"token\" style=\"color:#36acaa\">6</span>\nE<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">$</span>arrow.mode <span class=\"token\" style=\"color:#393A34\">&lt;-</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\nl <span class=\"token\" style=\"color:#393A34\">&lt;-</span> layout_with_dh<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><p>Then we plot the graph and add a legend.</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">plot<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">,</span> layout<span class=\"token\" style=\"color:#393A34\">=</span>l<span class=\"token\" style=\"color:#393A34\">,</span> arrow.mode<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Add a legend</span>\nlegend<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;bottomleft&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> legend<span class=\"token\" style=\"color:#393A34\">=</span>levels<span class=\"token\" style=\"color:#393A34\">(</span>as.factor<span class=\"token\" style=\"color:#393A34\">(</span>V<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">$</span>pid_type<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> col <span class=\"token\" style=\"color:#393A34\">=</span> col<span class=\"token\" style=\"color:#393A34\">,</span> bty <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;n&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> pch<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">20</span> <span class=\"token\" style=\"color:#393A34\">,</span> pt.cex <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">3</span><span class=\"token\" style=\"color:#393A34\">,</span> cex <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> horiz <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">FALSE</span><span class=\"token\" style=\"color:#393A34\">,</span> inset <span class=\"token\" style=\"color:#393A34\">=</span> c<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">0.1</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">0.1</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h1>Step 5: Generate resource lists</h1>\n<p>To accompany our graph, we can display lists of all the items that are in it. In this example, we&#x27;re showing APA-formatted citations for everything that&#x27;s a &quot;publication&quot; resource type. </p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Generate a list of formatted citations in APA format for the publications</span>\n\nids <span class=\"token\" style=\"color:#393A34\">&lt;-</span> substring<span class=\"token\" style=\"color:#393A34\">(</span>publications<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">17</span><span class=\"token\" style=\"color:#393A34\">)</span>\nids <span class=\"token\" style=\"color:#393A34\">&lt;-</span> paste<span class=\"token\" style=\"color:#393A34\">(</span>ids<span class=\"token\" style=\"color:#393A34\">,</span> collapse <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;,&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nurl <span class=\"token\" style=\"color:#393A34\">&lt;-</span> paste<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;https://api.datacite.org/dois?style=apa&amp;page[size]=250&amp;sort=created&amp;ids=&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> ids<span class=\"token\" style=\"color:#393A34\">,</span> sep <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nresponse <span class=\"token\" style=\"color:#393A34\">&lt;-</span> GET<span class=\"token\" style=\"color:#393A34\">(</span>url<span class=\"token\" style=\"color:#393A34\">,</span> accept<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;text/x-bibliography&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay_markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;## Publications&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay_markdown<span class=\"token\" style=\"color:#393A34\">(</span>content<span class=\"token\" style=\"color:#393A34\">(</span>response<span class=\"token\" style=\"color:#393A34\">,</span> as <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;text&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div></div></div>","internal":{"content":"{\n  \"cells\": [\n    {\n      \"cell_type\": \"markdown\",\n      \"source\": [\n        \"# PID Graph for publications from organization DataCite\\n\",\n        \"\\n\",\n        \"This notebook uses the [DataCite GraphQL API](https://api.datacite.org/graphql) to fetch all publications whose metadata includes a DataCite ROR affiliation identifier.\\n\",\n        \"\\n\",\n        \"This notebook uses R, but you could do the same thing in another language of your choice. \\n\",\n        \"\\n\",\n        \"It might be also be helpful to consult the [DataCite metadata schema](https://schema.datacite.org) for descriptions of resource types and other available fields. \\n\",\n        \"\\n\",\n        \"# Step 1: Prepare the R GraphQL client\\n\",\n        \"Load necessary libraries and set up the DataCite GraphQL API endpoint. \"\n      ],\n      \"metadata\": {}\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Prepare the R graphql client.\\n\",\n        \"\\n\",\n        \"library(\\\"httr\\\")\\n\",\n        \"library(\\\"ghql\\\")\\n\",\n        \"library(\\\"jsonlite\\\")\\n\",\n        \"library(\\\"IRdisplay\\\")\\n\",\n        \"library(\\\"dplyr\\\")\\n\",\n        \"library(\\\"igraph\\\")\\n\",\n        \"\\n\",\n        \"cli <- GraphqlClient$new(\\n\",\n        \"  url = \\\"https://api.datacite.org/client-api/graphql\\\"\\n\",\n        \")\\n\",\n        \"qry <- Query$new()\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": 4,\n      \"metadata\": {\n        \"inputHidden\": false,\n        \"outputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"markdown\",\n      \"source\": [\n        \"# Step 2: Generate the GraphQL query\\n\",\n        \"In this query, we are looking through DataCite DOIs and finding those that include DataCite's own organizational ROR ID as an affiliation identifier. \\n\",\n        \"\\n\",\n        \"DataCite DOIs can be assigned to datasets, publications, software and more. In this example we'll just be looking through DataCite DOIs that are assigned to datasets and publications, but the DataCite GraphQL API lets you specify what you want to search through and how we want to get information back. \"\n      ],\n      \"metadata\": {}\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"query <- '{\\n\",\n        \"  organization(id: \\\"https://ror.org/04wxnsj81\\\") {\\n\",\n        \"    publications(first: 150) {\\n\",\n        \"      totalCount\\n\",\n        \"      nodes {\\n\",\n        \"        id\\n\",\n        \"        creators {\\n\",\n        \"          id\\n\",\n        \"          affiliation {\\n\",\n        \"            id\\n\",\n        \"          }\\n\",\n        \"        }\\n\",\n        \"        relatedIdentifiers {\\n\",\n        \"          relatedIdentifier\\n\",\n        \"        }\\n\",\n        \"        fundingReferences {\\n\",\n        \"          funderIdentifier\\n\",\n        \"        }\\n\",\n        \"      }\\n\",\n        \"    }\\n\",\n        \"    datasets {\\n\",\n        \"      totalCount\\n\",\n        \"      nodes {\\n\",\n        \"        id\\n\",\n        \"        creators {\\n\",\n        \"          id\\n\",\n        \"          affiliation {\\n\",\n        \"            id\\n\",\n        \"          }\\n\",\n        \"        }\\n\",\n        \"        relatedIdentifiers {\\n\",\n        \"          relatedIdentifier\\n\",\n        \"        }\\n\",\n        \"        fundingReferences {\\n\",\n        \"          funderIdentifier\\n\",\n        \"        }\\n\",\n        \"      }\\n\",\n        \"    }\\n\",\n        \"  }\\n\",\n        \"}'\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": 5,\n      \"metadata\": {\n        \"inputHidden\": false,\n        \"outputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"markdown\",\n      \"source\": [\n        \"# Step 3: Run the query\"\n      ],\n      \"metadata\": {}\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Run the query and parse the JSON response\\n\",\n        \"\\n\",\n        \"qry$query('getdata', query)\\n\",\n        \"data <- fromJSON(cli$exec(qry$queries$getdata))\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": 6,\n      \"metadata\": {\n        \"inputHidden\": false,\n        \"outputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Get the number of publications and datasets\\n\",\n        \"\\n\",\n        \"display_json(data$data$organization$publications$totalCount)\\n\",\n        \"display_json(data$data$organization$datasets$totalCount)\"\n      ],\n      \"outputs\": [\n        {\n          \"output_type\": \"error\",\n          \"ename\": \"ERROR\",\n          \"evalue\": \"Error in prepare_content(isbinary, data, file): Either need to specify data or file, but not both\\n\",\n          \"traceback\": [\n            \"Error in prepare_content(isbinary, data, file): Either need to specify data or file, but not both\\nTraceback:\\n\",\n            \"1. display_json(data$data$organization$publications$totalCount)\",\n            \"2. display_raw(\\\"application/json\\\", FALSE, data, file)\",\n            \"3. prepare_content(isbinary, data, file)\",\n            \"4. stop(\\\"Either need to specify data or file, but not both\\\")\"\n          ]\n        }\n      ],\n      \"execution_count\": 7,\n      \"metadata\": {\n        \"inputHidden\": false,\n        \"outputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"markdown\",\n      \"source\": [\n        \"# Step 4: Make the graph\\n\",\n        \"First we need to prepare the data frame and define all of the nodes for the graph. \"\n      ],\n      \"metadata\": {}\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# generate data frame for nodes\\n\",\n        \"publications <- data.frame(id=data$data$organization$publications$nodes$id, pid_type=c('publication'))\\n\",\n        \"# datasets <- data.frame(id=data$data$organization$datasets$nodes$id, pid_type=c('dataset'))\\n\",\n        \"researchers <- data.frame(id=bind_rows(data$data$organization$publications$nodes$creators)[,1], pid_type=c('researcher'))\\n\",\n        \"researchers <- researchers %>% filter(!is.na(as.character(id)))\\n\",\n        \"# dataset_researchers <- data.frame(id=bind_rows(data$data$organization$datasets$nodes$creators)[,1], pid_type=c('researcher'))\\n\",\n        \"# dataset_researchers <- dataset_researchers %>% filter(!is.na(as.character(id)))\\n\",\n        \"organizations <- data.frame(id=bind_rows(bind_rows(data$data$organization$publications$nodes$creators)[,2])[,1], pid_type=c('organization'))\\n\",\n        \"organizations <- organizations %>% filter(!is.na(as.character(id)))\\n\",\n        \"#references <- data.frame(id=bind_rows(data$data$organization$publications$nodes$relatedIdentifiers)[,1], pid_type=c('publication'))\\n\",\n        \"#references <- references %>% filter(!is.na(as.character(id))) %>% mutate(id = ifelse(startsWith(as.character(id), '10.'), paste('https://doi.org/', id, sep=''), as.character(id)))\\n\",\n        \"# dataset_references <- data.frame(id=bind_rows(data$data$organization$datasets$nodes$relatedIdentifiers)[,1], pid_type=c('publication'))\\n\",\n        \"#dataset_references <- dataset_references %>% filter(!is.na(as.character(id))) %>% mutate(id = ifelse(startsWith(as.character(id), '10.'), paste('https://doi.org/', id, sep=''), as.character(id)))\\n\",\n        \"#funders <- data.frame(id=bind_rows(data$data$organization$publications$nodes$fundingReferences)[,1], pid_type=c('funder'))\\n\",\n        \"#dataset_funders <- data.frame(id=bind_rows(data$data$organization$datasets$nodes$fundingReferences)[,1], pid_type=c('funder'))\\n\",\n        \"nodes <- rbind(publications, researchers, organizations)\\n\",\n        \"\\n\",\n        \"# remove duplicates\\n\",\n        \"nodes <- nodes %>% distinct(id, .keep_all = TRUE)\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": null,\n      \"metadata\": {\n        \"inputHidden\": false,\n        \"outputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"markdown\",\n      \"source\": [\n        \"Then we define the edges, looping through each node as we go.\"\n      ],\n      \"metadata\": {}\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# loop through nodes, as they can have more than one edge\\n\",\n        \"edges <- data.frame(to=character(), from=character())\\n\",\n        \"nodes_with_creators <- bind_rows(data$data$organization$publications$nodes) %>% filter(lengths(creators) != 0)\\n\",\n        \"for (i in 1:nrow(nodes_with_creators)) {\\n\",\n        \"  row <- data.frame(to=unlist(nodes_with_creators[i,2]), from=nodes_with_creators[i,1])\\n\",\n        \"  edges <- unique(rbind(edges, row))\\n\",\n        \"}\\n\",\n        \"#dataset_nodes_with_creators <- bind_rows(data$data$organization$datasets$nodes) %>% filter(lengths(creators) != 0)\\n\",\n        \"#for (i in 1:nrow(dataset_nodes_with_creators)) {\\n\",\n        \"#  row <- data.frame(to=unlist(dataset_nodes_with_creators[i,2]), from=dataset_nodes_with_creators[i,1])\\n\",\n        \"#  edges <- unique(rbind(edges, row))\\n\",\n        \"#}\\n\",\n        \"\\n\",\n        \"#nodes_with_references <- bind_rows(data$data$organization$publications$nodes) %>% filter(lengths(relatedIdentifiers) != 0)\\n\",\n        \"#for (i in 1:nrow(nodes_with_references)) {\\n\",\n        \"#  row <- data.frame(to=unlist(nodes_with_references[i,3]), from=nodes_with_references[i,1])\\n\",\n        \"#  edges <- unique(rbind(edges, row))\\n\",\n        \"#}\\n\",\n        \"#dataset_nodes_with_references <- bind_rows(data$data$organization$datasets$nodes) %>% filter(lengths(relatedIdentifiers) != 0)\\n\",\n        \"#for (i in 1:nrow(dataset_nodes_with_references)) {\\n\",\n        \"#  row <- data.frame(to=unlist(dataset_nodes_with_references[i,3]), from=dataset_nodes_with_references[i,1])\\n\",\n        \"#  edges <- unique(rbind(edges, row))\\n\",\n        \"#}\\n\",\n        \"\\n\",\n        \"#nodes_with_dataset_references <- bind_rows(data$data$organization$datasets$nodes) %>% filter(lengths(relatedIdentifiers) != 0)\\n\",\n        \"#for (i in 1:nrow(nodes_with_dataset_references)) {\\n\",\n        \"#  row <- data.frame(to=unlist(nodes_with_dataset_references[i,3]), from=nodes_with_dataset_references[i,1])\\n\",\n        \"#  edges <- unique(rbind(edges, row))\\n\",\n        \"#}\\n\",\n        \"\\n\",\n        \"#nodes_with_funding <- bind_rows(data$data$organization$publications$nodes) %>% filter(lengths(fundingReferences) != 0)\\n\",\n        \"#for (i in 1:nrow(nodes_with_funding)) {\\n\",\n        \"#  row <- data.frame(to=unlist(nodes_with_funding[i,4]), from=nodes_with_funding[i,1])\\n\",\n        \"#  edges <- unique(rbind(edges, row))\\n\",\n        \"#}\\n\",\n        \"#dataset_nodes_with_funding <- bind_rows(data$data$organization$datasets$nodes) %>% filter(lengths(fundingReferences) != 0)\\n\",\n        \"#for (i in 1:nrow(dataset_nodes_with_funding)) {\\n\",\n        \"#  row <- data.frame(to=unlist(dataset_nodes_with_funding[i,4]), from=dataset_nodes_with_funding[i,1])\\n\",\n        \"#  edges <- unique(rbind(edges, row))\\n\",\n        \"#}\\n\",\n        \"\\n\",\n        \"# express DOIs as URLs\\n\",\n        \"edges <- edges %>% filter(!is.na(as.character(to))) %>% mutate(to = ifelse(startsWith(as.character(to), '10.'), paste('https://doi.org/', to, sep=''), as.character(to)))\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": null,\n      \"metadata\": {\n        \"inputHidden\": false,\n        \"outputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"markdown\",\n      \"source\": [\n        \"Next we format the graph for display, specifying color, node size, and other choices.\"\n      ],\n      \"metadata\": {}\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"g <- graph_from_data_frame(d=edges, vertices=nodes)\\n\",\n        \"\\n\",\n        \"# add node colors\\n\",\n        \"cols <- brewer.pal(12, \\\"Set3\\\")\\n\",\n        \"display.brewer.pal(12, \\\"Set3\\\")\\n\",\n        \"col = c('#ccff66','#48b1f4','#53c48c')\\n\",\n        \"V(g)[(V(g)$pid_type==\\\"publication\\\")]$color<-'#48b1f4'\\n\",\n        \"V(g)[(V(g)$pid_type==\\\"researcher\\\")]$color<-'#53c48c'\\n\",\n        \"#V(g)[(V(g)$pid_type==\\\"funder\\\")]$color<-'#fecf59'\\n\",\n        \"#V(g)[(V(g)$pid_type==\\\"dataset\\\")]$color<-'#e45718'\\n\",\n        \"V(g)[(V(g)$pid_type==\\\"organization\\\")]$color<-'#ccff66'\\n\",\n        \"\\n\",\n        \"# add labels to selected nodes\\n\",\n        \"V(g)$label=NA\\n\",\n        \"#V(g)[(V(g)$id==\\\"https://doi.org/10.5281/zenodo.1202173\\\")]$label<-\\\"B\\\"\\n\",\n        \"#V(g)[(V(g)$pid_type==\\\"funder\\\")]$label <- \\\"A\\\"\\n\",\n        \"#V(g)[(V(g)$pid_type==\\\"funder\\\")]$label.dist <- 1\\n\",\n        \"\\n\",\n        \"V(g)$size <- 6\\n\",\n        \"E(g)$arrow.mode <- 0\\n\",\n        \"l <- layout_with_dh(g)\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": null,\n      \"metadata\": {\n        \"inputHidden\": false,\n        \"outputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"markdown\",\n      \"source\": [\n        \"Then we plot the graph and add a legend.\"\n      ],\n      \"metadata\": {}\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"plot(g, layout=l, arrow.mode=0)\\n\",\n        \"\\n\",\n        \"# Add a legend\\n\",\n        \"legend(\\\"bottomleft\\\", legend=levels(as.factor(V(g)$pid_type)), col = col, bty = \\\"n\\\", pch=20 , pt.cex = 3, cex = 1, horiz = FALSE, inset = c(0.1, -0.1))\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": null,\n      \"metadata\": {\n        \"inputHidden\": false,\n        \"outputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"markdown\",\n      \"source\": [\n        \"# Step 5: Generate resource lists\\n\",\n        \"To accompany our graph, we can display lists of all the items that are in it. In this example, we're showing APA-formatted citations for everything that's a \\\"publication\\\" resource type. \"\n      ],\n      \"metadata\": {}\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Generate a list of formatted citations in APA format for the publications\\n\",\n        \"\\n\",\n        \"ids <- substring(publications[,1], 17)\\n\",\n        \"ids <- paste(ids, collapse = ',')\\n\",\n        \"url <- paste('https://api.datacite.org/dois?style=apa&page[size]=250&sort=created&ids=', ids, sep = '')\\n\",\n        \"response <- GET(url, accept(\\\"text/x-bibliography\\\"))\\n\",\n        \"display_markdown('## Publications')\\n\",\n        \"display_markdown(content(response, as = 'text'))\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": null,\n      \"metadata\": {\n        \"inputHidden\": false,\n        \"outputHidden\": false\n      }\n    }\n  ],\n  \"metadata\": {\n    \"kernel_info\": {\n      \"name\": \"ir\"\n    },\n    \"kernelspec\": {\n      \"display_name\": \"R\",\n      \"language\": \"R\",\n      \"name\": \"ir\"\n    },\n    \"language_info\": {\n      \"name\": \"R\",\n      \"codemirror_mode\": \"r\",\n      \"pygments_lexer\": \"r\",\n      \"mimetype\": \"text/x-r-source\",\n      \"file_extension\": \".r\",\n      \"version\": \"3.6.2\"\n    },\n    \"nteract\": {\n      \"version\": \"0.21.0\"\n    }\n  },\n  \"nbformat\": 4,\n  \"nbformat_minor\": 1\n}"},"fields":{"codemeta":{"identifier":null,"codeRepository":null,"controlledTem":null,"datePublished":null,"dateModified":null,"dateCreated":null,"description":null,"isAutomatedBuild":null,"issueTracker":null,"licenseId":null,"publisher":null,"name":null,"version":null}}}},"pageContext":{"slug":"/notebooks/pid-graph/r-organization-publications/r-organization-publications/"}}}