{"componentChunkName":"component---src-templates-notebook-js","path":"/notebooks/pid-graph/r-researcher-datasets/r-researcher-datasets/","result":{"data":{"jupyterNotebook":{"html":"<div class=\"notebook-render\"><div class=\"sc-iwsKbI Dticx\"><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-gZMcBi gmeReZ\"><h1>Publication references by researcher</h1>\n<p>This notebook uses the <a>DataCite GraphQL API</a> to fetch all DataCite references of the DataCite publications authored by a particular researcher, using his/her ORCID ID.</p></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[1742]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Prepare the R graphql client.</span>\n\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;httr&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;ghql&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;jsonlite&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;IRdisplay&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;dplyr&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nlibrary<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;igraph&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\ncli <span class=\"token\" style=\"color:#393A34\">&lt;-</span> GraphqlClient<span class=\"token\" style=\"color:#393A34\">$</span>new<span class=\"token\" style=\"color:#393A34\">(</span>\n  url <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;https://api.datacite.org/graphql&quot;</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\nqry <span class=\"token\" style=\"color:#393A34\">&lt;-</span> Query<span class=\"token\" style=\"color:#393A34\">$</span>new<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[1743]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Generate the GraphQL query: find the researcher by ORCID ID, then fetch the first 50 publications with DataCite DOIs linked to that ORCID account.</span>\n\nquery <span class=\"token\" style=\"color:#393A34\">&lt;-</span> &#x27;<span class=\"token\" style=\"color:#393A34\">{</span>\n   researcher<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;https://orcid.org/0000-0003-1419-2405&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n    id\n    name\n    softwares<span class=\"token\" style=\"color:#393A34\">(</span>first<span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#36acaa\">50</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n      totalCount\n      nodes <span class=\"token\" style=\"color:#393A34\">{</span>\n        id\n        relatedIdentifiers <span class=\"token\" style=\"color:#393A34\">{</span>\n          relationType\n          relatedIdentifier\n          relatedIdentifierType\n        <span class=\"token\" style=\"color:#393A34\">}</span>\n      <span class=\"token\" style=\"color:#393A34\">}</span>\n    <span class=\"token\" style=\"color:#393A34\">}</span>\n  <span class=\"token\" style=\"color:#393A34\">}</span>\n<span class=\"token\" style=\"color:#393A34\">}</span>&#x27;</code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[1744]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Run the query and parse the JSON response</span>\n\nqry<span class=\"token\" style=\"color:#393A34\">$</span>query<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;getdata&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> query<span class=\"token\" style=\"color:#393A34\">)</span>\ndata <span class=\"token\" style=\"color:#393A34\">&lt;-</span> fromJSON<span class=\"token\" style=\"color:#393A34\">(</span>cli<span class=\"token\" style=\"color:#393A34\">$</span>exec<span class=\"token\" style=\"color:#393A34\">(</span>qry<span class=\"token\" style=\"color:#393A34\">$</span>queries<span class=\"token\" style=\"color:#393A34\">$</span>getdata<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[1745]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Get the name of the researcher with ORCID ID https://orcid.org/0000-0003-1419-2405</span>\n\ndisplay_markdown<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>researcher<span class=\"token\" style=\"color:#393A34\">$</span>name<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-gzVnrw jFzGrB\"></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[1746]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Get the number of publications</span>\n\ndisplay_json<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>researcher<span class=\"token\" style=\"color:#393A34\">$</span>softwares<span class=\"token\" style=\"color:#393A34\">$</span>totalCount<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-gzVnrw jFzGrB\"></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># generate data frame for nodes</span>\nresearchers <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">=</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>researcher<span class=\"token\" style=\"color:#393A34\">$</span>id<span class=\"token\" style=\"color:#393A34\">,</span> pid_type<span class=\"token\" style=\"color:#393A34\">=</span>c<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;researcher&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nsoftwares <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">=</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>researcher<span class=\"token\" style=\"color:#393A34\">$</span>softwares<span class=\"token\" style=\"color:#393A34\">$</span>nodes<span class=\"token\" style=\"color:#393A34\">$</span>id<span class=\"token\" style=\"color:#393A34\">,</span> pid_type<span class=\"token\" style=\"color:#393A34\">=</span>c<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;dataset&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nreferences <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>id<span class=\"token\" style=\"color:#393A34\">=</span>bind_rows<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>researcher<span class=\"token\" style=\"color:#393A34\">$</span>softwares<span class=\"token\" style=\"color:#393A34\">$</span>nodes<span class=\"token\" style=\"color:#393A34\">$</span>relatedIdentifiers<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> pid_type<span class=\"token\" style=\"color:#393A34\">=</span>c<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;publication&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\nnodes <span class=\"token\" style=\"color:#393A34\">&lt;-</span> unique<span class=\"token\" style=\"color:#393A34\">(</span>rbind<span class=\"token\" style=\"color:#393A34\">(</span>researchers<span class=\"token\" style=\"color:#393A34\">,</span> softwares<span class=\"token\" style=\"color:#393A34\">,</span> references<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># generate data frame for edges</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># loop through nodes, as they can have more than one edge</span>\nedges <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">=</span>datasets<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> from<span class=\"token\" style=\"color:#393A34\">=</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>researcher<span class=\"token\" style=\"color:#393A34\">$</span>id<span class=\"token\" style=\"color:#393A34\">)</span>\nnodes_with_references <span class=\"token\" style=\"color:#393A34\">&lt;-</span> bind_rows<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">$</span>data<span class=\"token\" style=\"color:#393A34\">$</span>researcher<span class=\"token\" style=\"color:#393A34\">$</span>softwares<span class=\"token\" style=\"color:#393A34\">$</span>nodes<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token,percent-operator\" style=\"color:#393A34\">%&gt;%</span> filter<span class=\"token\" style=\"color:#393A34\">(</span>lengths<span class=\"token\" style=\"color:#393A34\">(</span>relatedIdentifiers<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span>\ne <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">=</span>character<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> from<span class=\"token\" style=\"color:#393A34\">=</span>character<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span>stringsAsFactors<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">FALSE</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> <span class=\"token\" style=\"color:#393A34\">(</span>i <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">:</span>nrow<span class=\"token\" style=\"color:#393A34\">(</span>nodes_with_references<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">{</span>\n  <span class=\"token\" style=\"color:#008000;font-style:italic\"># this is a workaround to capture all the edges</span>\n  row <span class=\"token\" style=\"color:#393A34\">&lt;-</span> data.frame<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">=</span>unlist<span class=\"token\" style=\"color:#393A34\">(</span>nodes_with_references<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> from<span class=\"token\" style=\"color:#393A34\">=</span>nodes_with_references<span class=\"token\" style=\"color:#393A34\">[</span>i<span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token,percent-operator\" style=\"color:#393A34\">%&gt;%</span> filter<span class=\"token\" style=\"color:#393A34\">(</span>startsWith<span class=\"token\" style=\"color:#393A34\">(</span>as.character<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;10.&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n  edges <span class=\"token\" style=\"color:#393A34\">&lt;-</span> unique<span class=\"token\" style=\"color:#393A34\">(</span>rbind<span class=\"token\" style=\"color:#393A34\">(</span>edges<span class=\"token\" style=\"color:#393A34\">,</span> row<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#393A34\">}</span>\n\nedges <span class=\"token\" style=\"color:#393A34\">&lt;-</span> edges <span class=\"token,percent-operator\" style=\"color:#393A34\">%&gt;%</span> mutate<span class=\"token\" style=\"color:#393A34\">(</span>to <span class=\"token\" style=\"color:#393A34\">=</span> ifelse<span class=\"token\" style=\"color:#393A34\">(</span>startsWith<span class=\"token\" style=\"color:#393A34\">(</span>as.character<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;10.&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> paste<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;https://doi.org/&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> to<span class=\"token\" style=\"color:#393A34\">,</span> sep<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&#x27;&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> as.character<span class=\"token\" style=\"color:#393A34\">(</span>to<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Some vertex names in edge list are not listed in vertex data frame</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># g &lt;- graph_from_data_frame(d=edges, vertices=nodes)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">#V(g)$color &lt;- c(&#x27;#48b1f4&#x27;, &#x27;#47a878&#x27;)[1+(V(g)$pid_type==&quot;researcher&quot;)]</span>\ng <span class=\"token\" style=\"color:#393A34\">&lt;-</span> graph_from_data_frame<span class=\"token\" style=\"color:#393A34\">(</span>d<span class=\"token\" style=\"color:#393A34\">=</span>edges<span class=\"token\" style=\"color:#393A34\">)</span>\nV<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">$</span>size <span class=\"token\" style=\"color:#393A34\">&lt;-</span> <span class=\"token\" style=\"color:#36acaa\">4</span>\nE<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">$</span>arrow.mode <span class=\"token\" style=\"color:#393A34\">&lt;-</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\nl <span class=\"token\" style=\"color:#393A34\">&lt;-</span> layout_with_dh<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">)</span>\nplot<span class=\"token\" style=\"color:#393A34\">(</span>g<span class=\"token\" style=\"color:#393A34\">,</span> vertex.label<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#0000ff\">NA</span><span class=\"token\" style=\"color:#393A34\">,</span> layout<span class=\"token\" style=\"color:#393A34\">=</span>l<span class=\"token\" style=\"color:#393A34\">,</span> arrow.mode<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Generate a list of formatted citations in APA format for the publications</span>\n\nids <span class=\"token\" style=\"color:#393A34\">&lt;-</span> substring<span class=\"token\" style=\"color:#393A34\">(</span>publications<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">17</span><span class=\"token\" style=\"color:#393A34\">)</span>\nids <span class=\"token\" style=\"color:#393A34\">&lt;-</span> paste<span class=\"token\" style=\"color:#393A34\">(</span>ids<span class=\"token\" style=\"color:#393A34\">,</span> collapse <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;,&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nurl <span class=\"token\" style=\"color:#393A34\">&lt;-</span> paste<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;https://api.datacite.org/dois?style=apa&amp;page[size]=250&amp;sort=created&amp;ids=&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> ids<span class=\"token\" style=\"color:#393A34\">,</span> sep <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nresponse <span class=\"token\" style=\"color:#393A34\">&lt;-</span> GET<span class=\"token\" style=\"color:#393A34\">(</span>url<span class=\"token\" style=\"color:#393A34\">,</span> accept<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;text/x-bibliography&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay_markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;## Publications&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay_markdown<span class=\"token\" style=\"color:#393A34\">(</span>content<span class=\"token\" style=\"color:#393A34\">(</span>response<span class=\"token\" style=\"color:#393A34\">,</span> as <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;text&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-dnqmqq iXBJUB\"><div class=\"sc-bZQynM ivRWoJ\"><div class=\"sc-bxivhb hjplrr\">[ ]</div><pre class=\"sc-EHOje jvzENE input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Generate a list of formatted citations in APA format for the references (if they are DataCite DOIs)</span>\n\nids <span class=\"token\" style=\"color:#393A34\">&lt;-</span> references<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">]</span>\nids <span class=\"token\" style=\"color:#393A34\">&lt;-</span> paste<span class=\"token\" style=\"color:#393A34\">(</span>ids<span class=\"token\" style=\"color:#393A34\">,</span> collapse <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;,&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nurl <span class=\"token\" style=\"color:#393A34\">&lt;-</span> paste<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;https://api.datacite.org/dois?style=apa&amp;page[size]=250&amp;sort=created&amp;ids=&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> ids<span class=\"token\" style=\"color:#393A34\">,</span> sep <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nresponse <span class=\"token\" style=\"color:#393A34\">&lt;-</span> GET<span class=\"token\" style=\"color:#393A34\">(</span>url<span class=\"token\" style=\"color:#393A34\">,</span> accept<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;text/x-bibliography&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay_markdown<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;## References&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndisplay_markdown<span class=\"token\" style=\"color:#393A34\">(</span>content<span class=\"token\" style=\"color:#393A34\">(</span>response<span class=\"token\" style=\"color:#393A34\">,</span> as <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;text&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>    </code></pre></div></div></div></div>","internal":{"content":"{\n  \"cells\": [\n    {\n      \"cell_type\": \"markdown\",\n      \"source\": [\n        \"# Publication references by researcher\\n\",\n        \"\\n\",\n        \"This notebook uses the [DataCite GraphQL API](https://api.datacite.org/graphql) to fetch all DataCite references of the DataCite publications authored by a particular researcher, using his/her ORCID ID.\"\n      ],\n      \"metadata\": {}\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Prepare the R graphql client.\\n\",\n        \"\\n\",\n        \"library(\\\"httr\\\")\\n\",\n        \"library(\\\"ghql\\\")\\n\",\n        \"library(\\\"jsonlite\\\")\\n\",\n        \"library(\\\"IRdisplay\\\")\\n\",\n        \"library(\\\"dplyr\\\")\\n\",\n        \"library(\\\"igraph\\\")\\n\",\n        \"\\n\",\n        \"cli <- GraphqlClient$new(\\n\",\n        \"  url = \\\"https://api.datacite.org/graphql\\\"\\n\",\n        \")\\n\",\n        \"qry <- Query$new()\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": 1742,\n      \"metadata\": {\n        \"collapsed\": false,\n        \"outputHidden\": false,\n        \"inputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Generate the GraphQL query: find the researcher by ORCID ID, then fetch the first 50 publications with DataCite DOIs linked to that ORCID account.\\n\",\n        \"\\n\",\n        \"query <- '{\\n\",\n        \"   researcher(id: \\\"https://orcid.org/0000-0003-1419-2405\\\") {\\n\",\n        \"    id\\n\",\n        \"    name\\n\",\n        \"    softwares(first: 50) {\\n\",\n        \"      totalCount\\n\",\n        \"      nodes {\\n\",\n        \"        id\\n\",\n        \"        relatedIdentifiers {\\n\",\n        \"          relationType\\n\",\n        \"          relatedIdentifier\\n\",\n        \"          relatedIdentifierType\\n\",\n        \"        }\\n\",\n        \"      }\\n\",\n        \"    }\\n\",\n        \"  }\\n\",\n        \"}'\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": 1743,\n      \"metadata\": {\n        \"collapsed\": false,\n        \"outputHidden\": false,\n        \"inputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Run the query and parse the JSON response\\n\",\n        \"\\n\",\n        \"qry$query('getdata', query)\\n\",\n        \"data <- fromJSON(cli$exec(qry$queries$getdata))\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": 1744,\n      \"metadata\": {\n        \"collapsed\": false,\n        \"outputHidden\": false,\n        \"inputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Get the name of the researcher with ORCID ID https://orcid.org/0000-0003-1419-2405\\n\",\n        \"\\n\",\n        \"display_markdown(data$data$researcher$name)\"\n      ],\n      \"outputs\": [\n        {\n          \"output_type\": \"display_data\",\n          \"data\": {\n            \"text/markdown\": [\n              \"Martin Fenner\"\n            ]\n          },\n          \"metadata\": {}\n        }\n      ],\n      \"execution_count\": 1745,\n      \"metadata\": {\n        \"collapsed\": false,\n        \"outputHidden\": false,\n        \"inputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Get the number of publications\\n\",\n        \"\\n\",\n        \"display_json(data$data$researcher$softwares$totalCount)\"\n      ],\n      \"outputs\": [\n        {\n          \"output_type\": \"error\",\n          \"ename\": \"ERROR\",\n          \"evalue\": \"Error in prepare_content(isbinary, data, file): Either need to specify data or file, but not both\\n\",\n          \"traceback\": [\n            \"Error in prepare_content(isbinary, data, file): Either need to specify data or file, but not both\\nTraceback:\\n\",\n            \"1. display_json(data$data$researcher$datasets$totalCount)\",\n            \"2. display_raw(\\\"application/json\\\", FALSE, data, file)\",\n            \"3. prepare_content(isbinary, data, file)\",\n            \"4. stop(\\\"Either need to specify data or file, but not both\\\")\"\n          ]\n        }\n      ],\n      \"execution_count\": 1746,\n      \"metadata\": {\n        \"collapsed\": false,\n        \"outputHidden\": false,\n        \"inputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# generate data frame for nodes\\n\",\n        \"researchers <- data.frame(id=data$data$researcher$id, pid_type=c('researcher'))\\n\",\n        \"softwares <- data.frame(id=data$data$researcher$softwares$nodes$id, pid_type=c('dataset'))\\n\",\n        \"references <- data.frame(id=bind_rows(data$data$researcher$softwares$nodes$relatedIdentifiers)[,2], pid_type=c('publication'))\\n\",\n        \"nodes <- unique(rbind(researchers, softwares, references))\\n\",\n        \"\\n\",\n        \"# generate data frame for edges\\n\",\n        \"# loop through nodes, as they can have more than one edge\\n\",\n        \"edges <- data.frame(to=datasets[,1], from=data$data$researcher$id)\\n\",\n        \"nodes_with_references <- bind_rows(data$data$researcher$softwares$nodes) %>% filter(lengths(relatedIdentifiers) != 0)\\n\",\n        \"e <- data.frame(to=character(), from=character(),stringsAsFactors=FALSE)\\n\",\n        \"for (i in 1:nrow(nodes_with_references)) {\\n\",\n        \"  # this is a workaround to capture all the edges\\n\",\n        \"  row <- data.frame(to=unlist(nodes_with_references[i,2]), from=nodes_with_references[i,1]) %>% filter(startsWith(as.character(to), '10.'))\\n\",\n        \"  edges <- unique(rbind(edges, row))\\n\",\n        \"}\\n\",\n        \"\\n\",\n        \"edges <- edges %>% mutate(to = ifelse(startsWith(as.character(to), '10.'), paste('https://doi.org/', to, sep=''), as.character(to)))\\n\",\n        \"\\n\",\n        \"# Some vertex names in edge list are not listed in vertex data frame\\n\",\n        \"# g <- graph_from_data_frame(d=edges, vertices=nodes)\\n\",\n        \"#V(g)$color <- c('#48b1f4', '#47a878')[1+(V(g)$pid_type==\\\"researcher\\\")]\\n\",\n        \"g <- graph_from_data_frame(d=edges)\\n\",\n        \"V(g)$size <- 4\\n\",\n        \"E(g)$arrow.mode <- 0\\n\",\n        \"l <- layout_with_dh(g)\\n\",\n        \"plot(g, vertex.label=NA, layout=l, arrow.mode=0)\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": null,\n      \"metadata\": {\n        \"collapsed\": false,\n        \"outputHidden\": false,\n        \"inputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Generate a list of formatted citations in APA format for the publications\\n\",\n        \"\\n\",\n        \"ids <- substring(publications[,1], 17)\\n\",\n        \"ids <- paste(ids, collapse = ',')\\n\",\n        \"url <- paste('https://api.datacite.org/dois?style=apa&page[size]=250&sort=created&ids=', ids, sep = '')\\n\",\n        \"response <- GET(url, accept(\\\"text/x-bibliography\\\"))\\n\",\n        \"display_markdown('## Publications')\\n\",\n        \"display_markdown(content(response, as = 'text'))\"\n      ],\n      \"outputs\": [],\n      \"execution_count\": null,\n      \"metadata\": {\n        \"collapsed\": false,\n        \"outputHidden\": false,\n        \"inputHidden\": false\n      }\n    },\n    {\n      \"cell_type\": \"code\",\n      \"source\": [\n        \"# Generate a list of formatted citations in APA format for the references (if they are DataCite DOIs)\\n\",\n        \"\\n\",\n        \"ids <- references[,1]\\n\",\n        \"ids <- paste(ids, collapse = ',')\\n\",\n        \"url <- paste('https://api.datacite.org/dois?style=apa&page[size]=250&sort=created&ids=', ids, sep = '')\\n\",\n        \"response <- GET(url, accept(\\\"text/x-bibliography\\\"))\\n\",\n        \"display_markdown('## References')\\n\",\n        \"display_markdown(content(response, as = 'text'))    \"\n      ],\n      \"outputs\": [],\n      \"execution_count\": null,\n      \"metadata\": {\n        \"collapsed\": false,\n        \"outputHidden\": false,\n        \"inputHidden\": false\n      }\n    }\n  ],\n  \"metadata\": {\n    \"kernel_info\": {\n      \"name\": \"ir\"\n    },\n    \"language_info\": {\n      \"name\": \"R\",\n      \"codemirror_mode\": \"r\",\n      \"pygments_lexer\": \"r\",\n      \"mimetype\": \"text/x-r-source\",\n      \"file_extension\": \".r\",\n      \"version\": \"3.6.0\"\n    },\n    \"kernelspec\": {\n      \"name\": \"ir\",\n      \"language\": \"R\",\n      \"display_name\": \"R\"\n    },\n    \"nteract\": {\n      \"version\": \"0.15.0\"\n    }\n  },\n  \"nbformat\": 4,\n  \"nbformat_minor\": 0\n}"},"fields":{"codemeta":{"identifier":null,"codeRepository":null,"controlledTem":null,"datePublished":null,"dateModified":null,"dateCreated":null,"description":null,"isAutomatedBuild":null,"issueTracker":null,"licenseId":null,"publisher":null,"name":null,"version":null}}}},"pageContext":{"slug":"/notebooks/pid-graph/r-researcher-datasets/r-researcher-datasets/"}}}